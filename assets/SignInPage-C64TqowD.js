import{c as P,r as i,u as O,a as M,j as a,m as l,A as Z,s as u}from"./index-CQht8NUj.js";import{M as A}from"./mail-BMluS0x3.js";import{L as I}from"./lock-CLQi7nVC.js";import{E as W}from"./eye-off-z23WP3MA.js";import{E as V}from"./eye-EqGLIY2z.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=P("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=P("AtSign",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=P("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),ae=()=>{const[c,S]=i.useState(""),[p,C]=i.useState(""),[g,U]=i.useState(""),[k,T]=i.useState(""),[o,f]=i.useState("signin"),[j,_]=i.useState(!1),[y,r]=i.useState(null),[w,m]=i.useState(!1),h=O(),x=M();i.useEffect(()=>{(async()=>{const{data:{session:t}}=await u.auth.getSession();if(t){const s=x.state,n=(s==null?void 0:s.from)||"/";h(n,{replace:!0})}})()},[h,x]),i.useEffect(()=>{const e=x.state;if(e!=null&&e.message){if(r(e.message),e.message.includes("Log In or Sign Up")){const t=setTimeout(()=>{r(null)},5e3);return()=>clearTimeout(t)}}else{r("Log In or Sign Up to use RollWithdraw.");const t=setTimeout(()=>{r(null)},5e3);return()=>clearTimeout(t)}e!=null&&e.mode&&f(e.mode)},[x]);const N=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),F=e=>/^[a-zA-Z0-9_]{3,16}$/.test(e),L=e=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{8,}$/.test(e),q=async()=>{if(!N(c)){r("Please enter a valid email address");return}m(!0);try{const{error:e}=await u.auth.resetPasswordForEmail(c,{redirectTo:"https://rollwithdraw.com/reset-password"});e?r(e.message):(r("Password reset link sent to your email"),f("signin"))}catch{r("Failed to send reset link. Please try again.")}finally{m(!1)}},D=async()=>{var e,t;if(!N(c)){r("Please enter a valid email address");return}m(!0);try{const{data:s,error:n}=await u.auth.signInWithPassword({email:c,password:g});if(n){switch(console.error("Signin Error:",{message:n.message,code:n.code,details:n.details}),n.code){case"invalid_grant":r("Invalid email or password. Please try again.");break;case"auth/user-not-found":r("No account found with this email. Please sign up.");break;case"auth/wrong-password":r("Incorrect password. Please try again.");break;default:r(n.message||"Authentication failed. Please try again.")}return}if(s.user)try{const{data:d,error:b}=await u.from("users").select("*").eq("auth_id",s.user.id).single();if(b){if(console.error("User fetch error:",{message:b.message,code:b.code,details:b.details}),!((e=s.user)!=null&&e.email)){r("Invalid user data. Please contact support.");return}const{error:E}=await u.from("users").insert({auth_id:s.user.id,email:s.user.email,username:((t=s.user.user_metadata)==null?void 0:t.username)||s.user.email.split("@")[0],created_at:new Date().toISOString(),status:"active",last_login:new Date().toISOString()});if(E){console.error("Profile creation error:",E),r("Failed to create user profile. Please contact support.");return}}const v=x.state;v!=null&&v.from?h(v.from):h("/dashboard"),window.dispatchEvent(new Event("authChange"))}catch(d){console.error("Profile retrieval error:",d),r("An unexpected error occurred. Please try again.")}else r("Authentication failed. Please try again.")}catch(s){console.error("Unexpected Signin Catch Error:",s),r("An unexpected error occurred. Please try again.")}finally{m(!1)}},R=async()=>{if(!F(p)){r("Username must be 3-16 characters, alphanumeric or underscores");return}if(!L(g)){r("Password must be at least 8 characters with uppercase, lowercase, and number");return}if(g!==k){r("Passwords do not match");return}m(!0);try{const{data:e,error:t}=await u.from("users").select("username").eq("username",p).maybeSingle();if(t){if(console.error("Username check error:",{code:t.code,message:t.message,details:t.details}),t.code==="42P01"){r("Database configuration error. Please contact support.");return}r("Error checking username availability");return}if(e){r("Username is already taken");return}const{data:s,error:n}=await u.auth.signUp({email:c,password:g,options:{data:{username:p,email_confirm:!0},emailRedirectTo:`${window.location.origin}/signin`}});if(n){console.error("Auth Signup Error:",{message:n.message,code:n.code,details:n.details}),r(n.message||"Failed to create account");return}if(s.user){const{error:d}=await u.from("users").insert({auth_id:s.user.id,email:s.user.email,username:p,created_at:new Date().toISOString(),status:"active"});if(d){console.error("Detailed Insert Error:",{message:d.message,code:d.code,details:d.details}),r(d.message||"Failed to create user profile");return}r("Account created successfully!"),setTimeout(()=>{h("/signin",{state:{message:"Please open your email to confirm your account.",mode:"signin"}})},2e3)}}catch(e){console.error("Unexpected Signup Error:",e),r("An unexpected error occurred. Please try again.")}finally{m(!1)}},$=async e=>{if(e.preventDefault(),r(null),!N(c)){r("Please enter a valid email address");return}switch(o){case"signin":await D();break;case"signup":await R();break;case"forgot-password":await q();break}},z={whileHover:{scale:1.05,transition:{type:"spring",stiffness:300}},whileTap:{scale:.95}},H={initial:{opacity:0,scale:.95},in:{opacity:1,scale:1,transition:{duration:.3,ease:"easeOut"}},out:{opacity:0,scale:.95,transition:{duration:.2,ease:"easeIn"}}};return a.jsxs("div",{className:"min-h-screen relative h-[100vh] overflow-hidden",children:[a.jsxs("div",{className:"absolute inset-0 h-[100vh]",children:[a.jsx("div",{style:{backgroundImage:"url(/hero_bg.jpg)",backgroundSize:"cover",backgroundPosition:"center",width:"100%",height:"100vh",opacity:1,filter:"blur(8px)",transform:"scale(1.1)"}}),a.jsx("div",{style:{backgroundColor:"rgba(0, 0, 0, 0.6)",position:"absolute",top:0,left:0,right:0,bottom:0,width:"100%",height:"100vh"}})]}),a.jsx("div",{className:"relative z-10 min-h-screen w-full flex items-center justify-center px-4 py-16",children:a.jsxs(l.div,{initial:"initial",animate:"in",exit:"out",variants:H,className:"w-full max-w-md relative",children:[a.jsx(Z,{children:y&&a.jsxs(l.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:`absolute -top-20 left-0 right-0 p-4 rounded-xl flex items-center justify-center ${y.includes("Log In or Sign Up")?"bg-purple-500/10 border border-purple-500 text-purple-400":y.includes("Account created successfully")?"bg-green-500/10 border border-green-500 text-green-400":"bg-red-500/10 border border-red-500 text-red-400"}`,children:[a.jsx(J,{className:"mr-3 w-6 h-6"}),a.jsx("span",{className:"text-center",children:y})]})}),a.jsxs("div",{className:"bg-gradient-to-br from-[#1a0b2e] to-[#130428] rounded-2xl shadow-2xl overflow-hidden",children:[a.jsx(l.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},className:"flex border-b border-[#8a4fff]/10",children:["signin","signup","forgot-password"].map(e=>a.jsx(l.button,{onClick:()=>{f(e),r(null)},whileHover:{scale:1.05},whileTap:{scale:.95},className:`
                    flex-1 py-4 text-lg font-semibold transition-all duration-300
                    ${o===e?"bg-[#8a4fff]/10 text-[#8a4fff]":"text-gray-400 hover:bg-[#8a4fff]/5"}
                  `,children:e==="signin"?"Sign In":e==="signup"?"Sign Up":"Reset"},e))}),a.jsxs("form",{onSubmit:$,className:"p-8 space-y-6",children:[o!=="forgot-password"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"relative",children:[a.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-[#8a4fff] opacity-70"}),a.jsx("input",{type:"email",placeholder:"Email Address",required:!0,value:c,onChange:e=>{S(e.target.value),r(null)},className:`w-full pl-10 pr-4 py-3 rounded-lg bg-[#2c1b4a] border border-[#8a4fff]/20 text-white 
                        focus:outline-none focus:border-[#8a4fff] transition-all duration-300`})]}),o==="signup"&&a.jsxs("div",{className:"relative",children:[a.jsx(G,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-[#8a4fff] opacity-70"}),a.jsx("input",{type:"text",placeholder:"Username",required:!0,value:p,onChange:e=>{C(e.target.value),r(null)},className:`w-full pl-10 pr-4 py-3 rounded-lg bg-[#2c1b4a] border border-[#8a4fff]/20 text-white 
                          focus:outline-none focus:border-[#8a4fff] transition-all duration-300`})]}),a.jsxs("div",{className:"relative",children:[a.jsx(I,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-[#8a4fff] opacity-70"}),a.jsx("input",{type:j?"text":"password",placeholder:"Password",required:!0,value:g,onChange:e=>{U(e.target.value),r(null)},className:`w-full pl-10 pr-10 py-3 rounded-lg bg-[#2c1b4a] border border-[#8a4fff]/20 text-white 
                        focus:outline-none focus:border-[#8a4fff] transition-all duration-300`}),a.jsx(l.button,{type:"button",onClick:()=>_(!j),whileHover:{scale:1.2},whileTap:{scale:.9},className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-[#8a4fff] opacity-70",children:j?a.jsx(W,{className:"w-5 h-5"}):a.jsx(V,{className:"w-5 h-5"})})]}),o==="signup"&&a.jsxs("div",{className:"relative",children:[a.jsx(I,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-[#8a4fff] opacity-70"}),a.jsx("input",{type:"password",placeholder:"Confirm Password",required:!0,value:k,onChange:e=>{T(e.target.value),r(null)},className:`w-full pl-10 pr-4 py-3 rounded-lg bg-[#2c1b4a] border border-[#8a4fff]/20 text-white 
                          focus:outline-none focus:border-[#8a4fff] transition-all duration-300`})]})]}),o==="forgot-password"&&a.jsxs("div",{className:"relative",children:[a.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-[#8a4fff] opacity-70"}),a.jsx("input",{type:"email",placeholder:"Enter your email",required:!0,value:c,onChange:e=>{S(e.target.value),r(null)},className:`w-full pl-10 pr-4 py-3 rounded-lg bg-[#2c1b4a] border border-[#8a4fff]/20 text-white 
                      focus:outline-none focus:border-[#8a4fff] transition-all duration-300`})]}),a.jsxs(l.button,{...z,type:"submit",disabled:w,className:`
                  w-full bg-gradient-to-r from-[#8a4fff] to-[#5e3c9b] 
                  text-white py-3 rounded-lg 
                  flex items-center justify-center
                  hover:opacity-90 transition-opacity
                  ${w?"opacity-50 cursor-not-allowed":""}
                `,children:[w?"Processing...":o==="signin"?"Sign In":o==="signup"?"Create Account":"Send Reset Link",!w&&a.jsx(B,{className:"ml-2 w-5 h-5"})]}),o==="signin"&&a.jsx("div",{className:"text-center",children:a.jsx("button",{type:"button",onClick:()=>f("forgot-password"),className:"text-[#8a4fff] hover:underline text-sm",children:"Forgot Password?"})})]}),a.jsxs(l.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},className:"bg-[#2c1b4a] border-t border-[#8a4fff]/10 p-4 text-center",children:[o==="signin"&&a.jsxs("p",{className:"text-gray-400",children:["Don't have an account?"," ",a.jsx(l.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>f("signup"),className:"text-[#8a4fff] hover:underline",children:"Sign Up"})]}),o==="signup"&&a.jsxs("p",{className:"text-gray-400",children:["Already have an account?"," ",a.jsx(l.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>f("signin"),className:"text-[#8a4fff] hover:underline",children:"Sign In"})]}),o==="forgot-password"&&a.jsxs("p",{className:"text-gray-400",children:["Remember your password?"," ",a.jsx(l.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>f("signin"),className:"text-[#8a4fff] hover:underline",children:"Sign In"})]})]})]})]})})]})};export{ae as default};
