import{c as se,b as ae,u as re,r as s,j as e,l as y,C as ie,m as u,T as ne,n as oe,h as le,o as P,G as ce,L as j,s as d,e as de,f as me,g as xe}from"./index-Br-8YYAX.js";import{C as D}from"./credit-card-DrL9m5Tn.js";import{F as fe}from"./file-text-BXqLH9Ez.js";import{S as ue}from"./shield-check-a3C-GufW.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=se("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),Me=()=>{const{cart:n,removeFromCart:L,getTotalPrice:q,updateQuantity:he,clearCart:G}=ae(),f=re(),[R,M]=s.useState(""),[be,ge]=s.useState(!1),[ye,je]=s.useState("bitcoin"),[we,$]=s.useState(!1),[b,a]=s.useState(null),[U,w]=s.useState(!0),[z,N]=s.useState(!1),[l,E]=s.useState(!1),[Y,O]=s.useState(!1);s.useEffect(()=>{n.filter(o=>o.id==="monthly"||o.id==="6-months"||o.id==="yearly"||o.id==="free-trial").length>1?a("You can only have one subscription in your cart at a time. Please remove any additional subscriptions before proceeding."):a(null)},[n]);const T=s.useMemo(()=>q(),[n]),g=s.useMemo(()=>T,[T]),[Ne,ve]=s.useState([{id:"skinport",name:"Skinport",logo:e.jsx(y,{className:"w-10 h-10 text-green-500"}),status:"coming_soon",description:"Popular skin trading platform"},{id:"dmarket",name:"DMarket",logo:e.jsx(y,{className:"w-10 h-10 text-blue-500"}),status:"coming_soon",description:"Global skin marketplace"},{id:"bitskins",name:"BitSkins",logo:e.jsx(y,{className:"w-10 h-10 text-purple-500"}),status:"coming_soon",description:"Trusted skin trading platform"}]),[W,H]=s.useState({id:"bitcoin",name:"Bitcoin",type:"crypto"}),K=[{id:"bitcoin",name:"Bitcoin",icon:e.jsx(de,{className:"lg:w-10 lg:h-10 w-7 h-7 text-[#F7931A]"}),type:"crypto"},{id:"ethereum",name:"Ethereum",icon:e.jsx(me,{className:"lg:w-10 lg:h-10 w-7 h-7 text-[#627EEA]"}),type:"crypto"},{id:"tether",name:"Tether",icon:e.jsx(xe,{className:"lg:w-10 lg:h-10 w-7 h-7 text-[#26A17B]"}),type:"crypto"},{id:"skins",name:"Skins",icon:e.jsx(P,{className:"w-7 h-7 text-[#1B2838]"}),type:"skin"}];s.useEffect(()=>{(async()=>{try{const{data:{session:o}}=await d.auth.getSession();if(!o){f("/signin",{state:{from:"/checkout",message:"Please sign in to complete your purchase"}}),w(!1);return}$(!0);const{data:{user:p}}=await d.auth.getUser();p&&M(p.email||""),n.length===0&&f("/dashboard",{state:{section:"purchases",message:"Purchase completed successfully! Your subscription is now active."}}),window.history.replaceState({},document.title),w(!1)}catch(o){console.error("Authentication check failed:",o),a("Failed to verify authentication. Please try again."),w(!1)}})()},[f,n]);const A=async()=>{var o,p;if(n.filter(r=>r.id==="monthly"||r.id==="6-months"||r.id==="yearly"||r.id==="free-trial").length>1){a("Only one subscription is allowed at a time. Please remove one of your subscriptions from the cart.");return}try{const{data:{user:r}}=await d.auth.getUser();if(!r){a("User not authenticated");return}let i=await d.from("users").select(`
          id, 
          current_subscription_id, 
          subscription_start_date, 
          subscription_end_date
        `).eq("auth_id",r.id).single();if(i.error||!i.data){const{data:c,error:_}=await d.from("users").insert({auth_id:r.id,email:r.email||"",username:((o=r.user_metadata)==null?void 0:o.username)||((p=r.email)==null?void 0:p.split("@")[0]),created_at:new Date().toISOString()}).select().single();if(_){console.error("User profile creation error:",_),a("Failed to create user profile");return}i={data:c,error:null,count:1,status:200,statusText:"OK"}}if(!i.data){a("Failed to get user data");return}const V={"1 Month Licence":{name:"1 Month Subscription",duration:1},"6 Months Licence":{name:"6 Months Subscription",duration:6},"12 Months Licence":{name:"12 Months Subscription",duration:12}},v=n[0].name,k=V[v]||{name:v,duration:1},{data:S,error:I}=await d.from("subscriptions").select("id, name, duration_days, price").or(`name.ilike.%${k.name}%,name.eq.${k.name}`);if(I){console.error("Subscription lookup error:",I),a("Could not find a matching subscription");return}if(!S||S.length===0){console.error("No matching subscription found",{cartItemName:v,mappedSubscriptionName:k.name}),a("No suitable subscription found. Please contact support.");return}const m=S[0];let C=m.id,x=new Date,h=new Date;if(i.data.current_subscription_id){const{data:c,error:_}=await d.from("subscriptions").select("id, name, duration_days, price").eq("id",i.data.current_subscription_id).single();if(c&&m.duration_days>c.duration_days){const Z=i.data.subscription_end_date?new Date(i.data.subscription_end_date):new Date,ee=Math.ceil((Z.getTime()-new Date().getTime())/(1e3*60*60*24)),te=m.price/m.duration_days*ee,Se=g-te;x=new Date,h=new Date(x),h.setDate(x.getDate()+m.duration_days)}else C=i.data.current_subscription_id,x=new Date(i.data.subscription_start_date||new Date),h=new Date(i.data.subscription_end_date||new Date)}else h=n[0].id==="free-trial"?new Date(x.getTime()+2*24*60*60*1e3):new Date(x.setDate(x.getDate()+m.duration_days));const ke=n.map(c=>({id:c.id,name:c.name,price:c.price,quantity:c.quantity})),{data:X,error:F}=await d.from("orders").insert({user_id:i.data.id,subscription_id:C,total_amount:g,transaction_date:new Date().toISOString(),status:"completed",items:[{id:m.id,name:m.name,price:g,quantity:1}]}).select().single();if(F){console.error("Order creation error:",F),a("Failed to process order. Please try again.");return}if(!X){a("Failed to create order. Please try again.");return}const{error:B}=await d.from("users").update({current_subscription_id:C,subscription_start_date:x.toISOString(),subscription_end_date:h.toISOString()}).eq("id",i.data.id);if(B){console.error("Subscription update error:",B),a("Failed to update subscription. Please contact support.");return}G(),f("/dashboard",{state:{section:"purchases",message:"Order completed successfully!"}})}catch(r){console.error("Order placement error:",r),a("An unexpected error occurred. Please try again.")}},Q=()=>e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs(u.div,{initial:{opacity:1,scale:.9},animate:{opacity:1,scale:1},className:"bg-[#0a0415] rounded-2xl p-8 max-w-md w-full border border-[#8a4fff]/10",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(fe,{className:"w-8 h-8 text-[#8a4fff] mr-4"}),e.jsx("h2",{className:"text-2xl font-semibold text-[#8a4fff]",children:"Policy Acknowledgment"})]}),e.jsxs("div",{className:"mb-6 text-gray-300 space-y-4",children:[e.jsx("p",{children:"Before completing your purchase, please review and acknowledge our:"}),e.jsxs("ul",{className:"list-disc list-inside",children:[e.jsx("li",{children:e.jsx(j,{to:"/terms",target:"_blank",className:"text-[#8a4fff] hover:underline",children:"Terms of Service"})}),e.jsx("li",{children:e.jsx(j,{to:"/privacy",target:"_blank",className:"text-[#8a4fff] hover:underline",children:"Privacy Policy"})}),e.jsx("li",{children:e.jsx(j,{to:"/refund",target:"_blank",className:"text-[#8a4fff] hover:underline",children:"Refund Policy"})})]})]}),e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("input",{type:"checkbox",id:"policy-acknowledge",checked:l,onChange:()=>E(!l),className:"mr-3 w-5 h-5 text-[#8a4fff] rounded focus:ring-[#8a4fff]"}),e.jsx("label",{htmlFor:"policy-acknowledge",className:"text-gray-300",children:"I have read and agree to the terms and conditions."})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{onClick:()=>O(!1),className:"flex-1 py-3 bg-transparent border border-[#8a4fff]/30 text-[#8a4fff] rounded-lg",children:"Cancel"}),e.jsx("button",{onClick:()=>{l&&(O(!1),A())},disabled:!l,className:`
              flex-1 py-3 rounded-lg
              ${l?"bg-[#8a4fff] text-white":"bg-gray-500 text-gray-300 cursor-not-allowed"}
            `,children:"Confirm"})]})]})}),J=()=>e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 overflow-y-auto",children:e.jsxs(u.div,{initial:{opacity:1,scale:.9},animate:{opacity:1,scale:1},className:"bg-[#0a0415] rounded-2xl p-4 sm:p-8 max-w-3xl w-full border border-[#8a4fff]/10 my-4 sm:my-8",children:[e.jsx("div",{className:"flex items-center mb-4 sm:mb-6 sticky top-0 bg-[#0a0415] z-10",children:e.jsx("h2",{className:"text-[20px] sm:text-2xl font-semibold text-[#8a4fff] m-auto",children:"Skin Transfer Marketplaces"})}),e.jsxs("div",{className:"mb-4 sm:mb-6 text-gray-300 space-y-3 sm:space-y-4",children:[e.jsx("p",{className:"text-center text-[14px] sm:text-base",children:"Select a marketplace to transfer your skins seamlessly."}),e.jsx("div",{className:"grid md:grid-cols-3 gap-3 sm:gap-4",children:[{id:"bitskins",name:"BitSkins",logo:e.jsx(y,{className:"w-5 h-5 sm:w-6 sm:h-6 text-purple-500"}),description:"Trusted skin trading platform",url:"https://bitskins.com/",status:"active"},{id:"tradeit",name:"TradeIt.gg",logo:e.jsx(P,{className:"w-5 h-5 sm:w-6 sm:h-6 text-[#1B2838]"}),description:"Instant skin trading platform",url:"https://tradeit.gg/",status:"active"}].map(t=>e.jsxs(u.div,{whileHover:{scale:1.05},whileTap:{scale:.95},className:`
                  bg-[#2c1b4a] rounded-xl p-4 sm:p-6 text-center relative
                  transition-all duration-300 
                  ${t.status==="active"?"hover:border-[#8a4fff] border border-transparent":"opacity-50 cursor-not-allowed"}
                `,children:[e.jsx("div",{className:"flex justify-center mb-3 sm:mb-4",children:t.logo}),e.jsx("h3",{className:"text-[16px] sm:text-lg font-semibold mb-2 text-white",children:t.name}),e.jsx("p",{className:"text-gray-400 text-[12px] sm:text-sm mb-3 sm:mb-4",children:t.description}),e.jsx("button",{onClick:()=>{t.status==="active"&&window.open(t.url,"_blank","noopener,noreferrer")},disabled:t.status!=="active",className:`
                    w-full py-2 sm:py-3 rounded-lg transition-colors text-[12px] sm:text-sm
                    ${t.status==="active"?"bg-[#8a4fff] text-white hover:bg-[#7a3ddf]":"bg-gray-500 text-gray-300 cursor-not-allowed"}
                  `,children:t.status==="active"?"Open Marketplace":"Coming Soon"})]},t.id))})]}),e.jsxs("div",{className:"flex items-center space-x-2 bg-[#2c1b4a] p-3 sm:p-4 rounded-xl mb-4 sm:mb-6",children:[e.jsx(ue,{className:"w-5 h-5 sm:w-6 sm:h-6 text-green-500"}),e.jsx("p",{className:"text-[12px] sm:text-sm text-gray-300",children:"We recommend using trusted marketplaces and verifying trade details."})]}),e.jsxs("div",{className:"flex space-x-3 sm:space-x-4",children:[e.jsx("button",{onClick:()=>N(!1),className:"flex-1 py-2 sm:py-3 bg-transparent border border-[#8a4fff]/30 text-[#8a4fff] rounded-lg text-[14px] sm:text-sm",children:"Close"}),e.jsx("button",{onClick:()=>{window.open("/contact","_blank"),N(!1)},className:"flex-1 py-2 sm:py-3 bg-[#8a4fff] text-white rounded-lg hover:bg-[#7a3ddf] text-[14px] sm:text-sm",children:"Contact Support"})]})]})});if(U){const t=location.state;return e.jsxs("div",{className:"min-h-screen bg-[#04011C] flex items-center justify-center",children:[(t==null?void 0:t.message)&&e.jsx("div",{className:"absolute top-20 w-full max-w-md",children:e.jsxs("div",{className:"bg-emerald-500/10 border border-emerald-500 text-emerald-400 p-4 rounded-xl flex items-center",children:[e.jsx(ie,{className:"mr-3 w-6 h-6"}),t.message]})}),e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 "})]})}return n.length===0?e.jsx("div",{className:"min-h-screen bg-[#04011C] flex items-center justify-center px-4 py-16",children:e.jsxs(u.div,{initial:{opacity:1,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5},className:"max-w-md w-full text-center bg-[#0a0415] rounded-3xl p-12 border border-[#8a4fff]/10",children:[e.jsx("div",{className:"w-32 h-32 mx-auto mb-8 flex items-center justify-center bg-[#8a4fff]/10 rounded-full",children:e.jsx(D,{className:"w-16 h-16 text-[#8a4fff] opacity-70"})}),e.jsx("h2",{className:"text-4xl font-bold text-white mb-6",children:"Cart is Empty"}),e.jsx("p",{className:"text-gray-400 mb-10 text-lg",children:"Add items to get started"}),e.jsx("button",{onClick:()=>f("/"),className:`w-full py-4 bg-[#8a4fff] 
            text-white rounded-xl hover:bg-[#7a3ddf] transition-colors text-lg`,children:"Browse Products"})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"min-h-screen bg-[#04011C] py-8 sm:py-16 px-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs(u.div,{initial:{opacity:1,y:0},animate:{opacity:1,y:0},transition:{duration:.4},className:"flex items-center mt-6 sm:mt-10",children:[e.jsxs("button",{onClick:()=>f("/"),className:"text-gray-400 hover:text-[#8a4fff] flex items-center mr-auto mb-12 sm:mb-20",children:[e.jsx(pe,{className:"mr-2  w-5 h-5 mt-5 sm:w-6 sm:h-6"}),e.jsx("span",{className:"text-[14px] sm:text-base mt-5",children:"Back"})]}),e.jsx("h1",{className:"text-[24px] sm:text-3xl font-bold text-white absolute  mt-2 left-1/2 transform -translate-x-1/2 pt-4",children:"Checkout"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 sm:gap-8",children:[e.jsxs(u.div,{initial:{opacity:1,x:0},animate:{opacity:1,x:0},transition:{duration:.5,delay:.2},className:"space-y-4 sm:space-y-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-[#210746] to-[#2C095D] rounded-2xl sm:rounded-3xl p-4 sm:p-8 border border-[#8a4fff]/10",children:[e.jsxs("h2",{className:"text-[18px] sm:text-xl font-semibold text-[#8a4fff] mb-4 sm:mb-6 flex items-center",children:[e.jsx(D,{className:"mr-2 sm:mr-3 w-5 h-5 sm:w-6 sm:h-6"})," Your Items"]}),e.jsx("div",{className:"space-y-3 sm:space-y-4",children:n.map(t=>e.jsxs("div",{className:"flex justify-between items-center pb-3 sm:pb-4 border-b border-[#8a4fff]/10 last:border-b-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-[16px] sm:text-lg font-bold text-white",children:t.name}),e.jsxs("p",{className:"text-gray-400 text-[12px] sm:text-sm",children:[t.id==="free-trial"&&"CSGORoll Script",t.id==="monthly"&&"CSGORoll Script",t.id==="6-months"&&"CSGORoll Script",t.id==="yearly"&&"CSGORoll Script"]})]}),e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-4",children:[e.jsxs("span",{className:"text-[16px] sm:text-lg font-bold text-[#8a4fff] mr-2",children:["€",t.price.toFixed(2)]}),e.jsx("button",{onClick:()=>L(t.id),className:"text-red-500 hover:text-red-400",children:e.jsx(ne,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]},t.id))}),b&&e.jsxs("div",{className:"mt-4 bg-red-500/10 border border-red-500 text-red-400 p-3 rounded-xl flex items-center",children:[e.jsx(oe,{className:"mr-2 w-5 h-5"}),e.jsx("span",{className:"text-[14px]",children:b})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-[#210746] to-[#2C095D] rounded-2xl sm:rounded-3xl p-4 sm:p-8 border border-[#8a4fff]/10",children:[e.jsxs("h2",{className:"text-[18px] sm:text-xl font-semibold text-[#8a4fff] mb-4 sm:mb-6 flex items-center",children:[e.jsx(le,{className:"mr-2 sm:mr-3 w-5 h-5 sm:w-6 sm:h-6"})," Payment Method"]}),e.jsx("div",{className:"grid grid-cols-3 gap-2 sm:gap-4",children:K.slice(0,3).map(t=>e.jsxs("button",{onClick:()=>{H({id:t.id,name:t.name,type:t.type})},className:`
                        flex flex-col items-center justify-center p-2 sm:p-4 rounded-xl
                        ${W.id===t.id?"bg-[#8a4fff]/10 border-2 border-[#8a4fff]":"bg-[#1a0b2e] border-2 border-transparent"}
                        transition-all duration-300 hover:bg-[#8a4fff]/10
                      `,children:[e.jsx("div",{className:"w-6 h-6 sm:w-10 sm:h-10 mr-1 lg:mr-[-1px]",children:t.icon}),e.jsx("span",{className:"mt-2 sm:mt-3 text-[12px] sm:text-sm text-white",children:t.name})]},t.id))}),e.jsxs("div",{className:"mt-4 sm:mt-6 bg-[#2c1b4a] rounded-xl p-4 sm:p-4 border border-[#8a4fff]/20",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2 sm:mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[e.jsx(P,{className:"w-5 h-5 sm:w-6 sm:h-6 text-[#8a4fff]"}),e.jsx("h3",{className:"text-[18px] sm:text-[20px] font-semibold text-[#8a4fff]",children:"Skin Payment"})]}),e.jsx("span",{className:"bg-yellow-500/20 text-yellow-400 text-[10px] sm:text-xs px-2 py-1 rounded-full",children:"Coming Soon"})]}),e.jsx("p",{className:"text-gray-300 mb-2 sm:mb-3 text-[14px] sm:text-base",children:"We're working on integrating multiple skin marketplaces for seamless trading."}),e.jsxs("button",{onClick:()=>N(!0),className:`w-full bg-[#8a4fff]/10 text-[#8a4fff] 
                    py-2 sm:py-3 rounded-lg hover:bg-[#8a4fff]/20 
                    transition-colors mt-4 flex items-center justify-center text-[14px] sm:text-base`,children:[e.jsx(ce,{className:"mr-2 w-4 h-4 sm:w-5 sm:h-5"}),"Learn More About Skin Payments"]})]})]})]}),e.jsxs(u.div,{initial:{opacity:1,x:0},animate:{opacity:1,x:0},transition:{duration:.5,delay:.2},className:"bg-gradient-to-br from-[#210746] to-[#2C095D] rounded-2xl sm:rounded-3xl p-4 sm:p-8 border border-[#8a4fff]/10 h-fit",children:[e.jsxs("h2",{className:"text-[18px] sm:text-xl font-semibold text-[#8a4fff] mb-4 sm:mb-6 flex items-center",children:[e.jsx(D,{className:"mr-2 sm:mr-3 w-5 h-5 sm:w-6 sm:h-6"})," Order Summary"]}),e.jsx("div",{className:"space-y-3 sm:space-y-4 mb-6 sm:mb-8",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400 text-[14px] sm:text-base",children:"Total"}),e.jsxs("span",{className:"text-[18px] sm:text-2xl font-bold text-[#8a4fff]",children:["€",g.toFixed(2)]})]})}),e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("label",{className:"block text-[12px] sm:text-sm text-gray-400 mb-2",children:"Email Address"}),e.jsx("input",{type:"email",value:R,onChange:t=>{M(t.target.value),a(null)},placeholder:"Enter your email",className:`w-full p-2.5 sm:p-3 bg-[#1a0b2e] rounded-xl text-[14px] sm:text-base text-white 
                  border border-[#8a4fff]/20 focus:border-[#8a4fff] 
                  transition-colors`})]}),e.jsxs("div",{className:"mb-4 sm:mb-6 flex items-center",children:[e.jsx("input",{type:"checkbox",id:"policy-checkbox",checked:l,onChange:()=>E(!l),className:"mr-2 sm:mr-3 w-4 h-4 sm:w-5 sm:h-5 text-[#8a4fff] rounded focus:ring-[#8a4fff]"}),e.jsxs("label",{htmlFor:"policy-checkbox",className:"text-gray-400 flex items-center text-[14px] sm:text-sm",children:["I've read and accept the"," ",e.jsx(j,{to:"/policy",className:"ml-1 text-[#8a4fff] hover:underline",children:"Policies"})]})]}),e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsx("button",{onClick:A,disabled:!l||b!==null,className:`
                    w-full py-3 sm:py-4 rounded-xl transition-colors text-[14px] sm:text-lg
                    ${l&&!b?"bg-[#8a4fff] text-white hover:bg-[#7a3ddf]":"bg-gray-500 text-gray-300 cursor-not-allowed"}
                  `,children:"Place Order"}),e.jsx("button",{onClick:()=>f("/"),className:`w-full py-3 sm:py-4 bg-transparent border border-[#8a4fff]/30 
                    text-[#8a4fff] rounded-xl hover:bg-[#8a4fff]/10 
                    transition-colors text-[14px] sm:text-lg`,children:"Cancel"})]})]})]})]})}),Y&&e.jsx(Q,{}),z&&e.jsx(J,{})]})};export{Me as default};
