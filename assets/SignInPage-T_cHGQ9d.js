import{c as L,r as o,u as Q,a as X,g as Y,j as s,m as n,A as ee,I as E,h as _,E as R,i as U,k as se,s as f,l as T}from"./index-Bo_KBEeX.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=L("AtSign",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=L("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),ne=()=>{const[i,S]=o.useState(""),[y,H]=o.useState(""),[h,$]=o.useState(""),[k,q]=o.useState(""),[a,d]=o.useState("signin"),[m,P]=o.useState(!1),[b,t]=o.useState(null),[x,l]=o.useState(!1),[re,ae]=o.useState(!1),[F,C]=o.useState(!1),v=Q(),w=X(),[I]=Y();o.useEffect(()=>{const e=I.get("ref");e&&(d("signup"),localStorage.setItem("referralCode",e))},[I]),o.useEffect(()=>{(async()=>{const{data:{session:r}}=await f.auth.getSession();if(r){const c=w.state,u=(c==null?void 0:c.from)||"/dashboard";v(u,{replace:!0})}})()},[v,w]),o.useEffect(()=>{const e=w.state;if(e!=null&&e.message){if(t(e.message),e.message.includes("Log In or Sign Up")){const r=setTimeout(()=>{t(null)},5e3);return()=>clearTimeout(r)}}else{t("Log In or Sign Up to use RollWithdraw.");const r=setTimeout(()=>{t(null)},5e3);return()=>clearTimeout(r)}e!=null&&e.mode&&d(e.mode)},[w]);const j=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),O=e=>/^[a-zA-Z0-9_]{3,16}$/.test(e),z=e=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{8,}$/.test(e),Z=async()=>{if(!j(i)){t("Please enter a valid email address");return}l(!0);try{const e=await T(i);e.success?(t("Password reset link sent to your email"),d("signin")):t(e.message)}catch{t("Failed to send reset link. Please try again.")}finally{l(!1)}},V=async e=>{e.preventDefault(),t(null),l(!0);try{const{error:r}=await f.auth.signInWithPassword({email:i,password:h});if(r){t(r.message);return}v("/dashboard")}catch{t("An unexpected error occurred")}finally{l(!1)}},W=async e=>{if(e.preventDefault(),t(null),l(!0),!j(i)){t("Please enter a valid email address"),l(!1);return}if(!O(y)){t("Username must be 3-16 characters and contain only letters, numbers, and underscores"),l(!1);return}if(!z(h)){t("Password must be at least 8 characters and contain uppercase, lowercase, and numbers"),l(!1);return}if(h!==k){t("Passwords do not match"),l(!1);return}try{const r=localStorage.getItem("referralCode");console.log("Referral code from localStorage:",r);let c=null;if(r){console.log("Verifying referral code:",r);const{data:p,error:g}=await f.from("referral_codes").select("user_id").eq("code",r).eq("is_active",!0).maybeSingle();g?console.error("Referral code verification error:",g):p?(c=p.user_id,console.log("Found referrer ID:",c)):console.log("No active referral code found for:",r)}console.log("Creating auth user...");const{data:u,error:N}=await f.auth.signUp({email:i,password:h,options:{emailRedirectTo:`${window.location.origin}/rw/signin`}});if(N)throw console.error("Auth user creation error:",N),N;if(u.user){console.log("Auth user created:",u.user.id),console.log("Creating user record...");const{data:p,error:g}=await f.from("users").insert({auth_id:u.user.id,email:i,username:y,created_at:new Date().toISOString(),last_login:new Date().toISOString(),status:"active",referred_by:r||null,referral_count:0,total_referral_earnings:0,subscription_end_date:null}).select().single();if(g)throw console.error("User record creation error:",g),await f.auth.admin.deleteUser(u.user.id),g;if(console.log("User record created:",p),c&&p){console.log("Creating referral record...",{referrerId:c,referredId:u.user.id});const{data:M,error:A}=await f.from("referrals").insert({referrer_id:c,referred_id:u.user.id,status:"signed_up",reward_amount:"7 days"}).select().single();A?console.error("Referral creation error:",A):console.log("Referral created successfully:",M)}else console.log("Skipping referral creation:",{hasReferrerId:!!c,hasUserData:!!p});localStorage.removeItem("referralCode"),t("Account created successfully! Please check your email to verify your account."),d("signin")}}catch(r){console.error("Signup error:",r),t(r.message||"An error occurred during signup")}finally{l(!1)}},B=async()=>{if(!i){t("Please enter your email address");return}l(!0),t(null);try{const e=await T(i);e.success?C(!0):t(e.message)}catch{t("Failed to send reset link")}finally{l(!1)}},G=async e=>{if(e.preventDefault(),t(null),!j(i)){t("Please enter a valid email address");return}switch(a){case"signin":await V(e);break;case"signup":await W(e);break;case"forgot-password":await Z();break}},J={whileHover:{scale:1.05,transition:{type:"spring",stiffness:300}},whileTap:{scale:.95}},K={initial:{opacity:1,scale:.95},in:{opacity:1,scale:1,transition:{duration:.3,ease:"easeOut"}},out:{opacity:1,scale:.95,transition:{duration:.2,ease:"easeIn"}}};return s.jsxs("div",{className:"min-h-screen relative h-[100vh] overflow-hidden",children:[s.jsxs("div",{className:"absolute inset-0 h-[100vh]",children:[s.jsx("div",{style:{backgroundImage:"url(/rw/hero_bg.jpg)",backgroundSize:"cover",backgroundPosition:"center",width:"100%",height:"100vh",opacity:1,filter:"blur(8px)",transform:"scale(1.1)"}}),s.jsx("div",{style:{backgroundColor:"rgba(0, 0, 0, 0.6)",position:"absolute",top:0,left:0,right:0,bottom:0,width:"100%",height:"100vh"}})]}),s.jsx("div",{className:"relative z-10 min-h-screen w-full flex items-center justify-center px-4 py-8 sm:py-16",children:s.jsxs(n.div,{initial:"initial",animate:"in",exit:"out",variants:K,className:"w-full max-w-md relative",children:[s.jsxs(ee,{children:[b&&s.jsxs(n.div,{initial:{opacity:1,y:-20},animate:{opacity:1,y:0},exit:{opacity:1,y:-20},className:`absolute ${a==="signup"?"-top-[90px] sm:-top-[120px]":"-top-[80px] sm:-top-30"} left-0 right-0 p-3 sm:p-4 rounded-xl flex items-center justify-center ${b.includes("Log In or Sign Up")?"bg-purple-500/10 border border-purple-500 text-purple-400":b.includes("Account created successfully")?"bg-green-500/10 border border-green-500 text-green-400":"bg-red-500/10 border border-red-500 text-red-400"}`,children:[s.jsx(E,{className:"mr-2 sm:mr-3 w-5 h-5 sm:w-6 sm:h-6"}),s.jsx("span",{className:"text-[14px] sm:text-base text-center",children:b})]}),F&&s.jsxs(n.div,{initial:{opacity:1,y:-20},animate:{opacity:1,y:0},exit:{opacity:1,y:-20},className:"absolute -top-[80px] sm:-top-20 left-0 right-0 p-3 sm:p-4 rounded-xl flex items-center justify-center bg-green-500/10 border border-green-500 text-green-400",children:[s.jsx(E,{className:"mr-2 sm:mr-3 w-5 h-5 sm:w-6 sm:h-6"}),s.jsx("span",{className:"text-[14px] sm:text-base text-center",children:"Password reset link has been sent to your email"})]})]}),s.jsxs("div",{className:"bg-gradient-to-br from-[#1a0b2e] to-[#130428] rounded-2xl shadow-2xl overflow-hidden",children:[s.jsx(n.div,{initial:{opacity:1},animate:{opacity:1},transition:{duration:.5},className:"flex border-b border-[#8a4fff]/10",children:["signin","signup","forgot-password"].map(e=>s.jsx(n.button,{onClick:()=>{d(e),t(null)},whileHover:{scale:1.05},whileTap:{scale:.95},className:`
                    flex-1 py-3 sm:py-4 text-[16px] sm:text-lg font-semibold transition-all duration-300
                    ${a===e?"bg-[#8a4fff]/10 text-[#8a4fff]":"text-gray-400 hover:bg-[#8a4fff]/5"}
                  `,children:e==="signin"?"Sign In":e==="signup"?"Sign Up":"Reset"},e))}),s.jsxs("form",{onSubmit:G,className:"p-6 sm:p-8 space-y-4 sm:space-y-6 ",children:[a!=="forgot-password"&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"relative",children:[s.jsx(D,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-[#8a4fff] opacity-70 w-4 h-4 sm:w-5 sm:h-5 "}),s.jsx("input",{type:"email",placeholder:"Email Address",required:!0,value:i,onChange:e=>{S(e.target.value),t(null),C(!1)},className:`w-full pl-10 sm:pl-10 pr-4 py-2.5 sm:py-3 rounded-lg bg-[#2c1b4a] border border-[#8a4fff]/20 text-white text-[14px] sm:text-base
                        focus:outline-none focus:border-[#8a4fff] transition-all duration-300`})]}),a==="signup"&&s.jsxs("div",{className:"relative",children:[s.jsx(te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-[#8a4fff] opacity-70 w-4 h-4 sm:w-5 sm:h-5"}),s.jsx("input",{type:"text",placeholder:"Username",required:!0,value:y,onChange:e=>{H(e.target.value),t(null)},className:`w-full pl-10 sm:pl-10 pr-4 py-2.5 sm:py-3 rounded-lg bg-[#2c1b4a] border border-[#8a4fff]/20 text-white text-[14px] sm:text-base
                          focus:outline-none focus:border-[#8a4fff] transition-all duration-300`})]}),s.jsxs("div",{className:"relative",children:[s.jsx(_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-[#8a4fff] opacity-70 w-4 h-4 sm:w-5 sm:h-5"}),s.jsx("input",{type:m?"text":"password",placeholder:"Password",required:!0,value:h,onChange:e=>{$(e.target.value),t(null)},className:`w-full pl-10 sm:pl-10 pr-10 py-2.5 sm:py-3 rounded-lg bg-[#2c1b4a] border border-[#8a4fff]/20 text-white text-[14px] sm:text-base
                        focus:outline-none focus:border-[#8a4fff] transition-all duration-300`}),s.jsx(n.button,{type:"button",onClick:()=>P(!m),whileHover:{scale:1.2},whileTap:{scale:1.2},className:"absolute right-3 lg:bottom-4 bottom-3 text-[#8a4fff] opacity-70",children:m?s.jsx(R,{className:"w-4 h-4 sm:w-5 sm:h-5"}):s.jsx(U,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]}),a==="signup"&&s.jsxs("div",{className:"relative",children:[s.jsx(_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-[#8a4fff] opacity-70 w-4 h-4 sm:w-5 sm:h-5"}),s.jsx("input",{type:m?"text":"password",placeholder:"Confirm Password",required:!0,value:k,onChange:e=>{q(e.target.value),t(null)},className:`w-full pl-10 sm:pl-10 pr-10 py-2.5 sm:py-3 rounded-lg bg-[#2c1b4a] border border-[#8a4fff]/20 text-white text-[14px] sm:text-base
                          focus:outline-none focus:border-[#8a4fff] transition-all duration-300`}),s.jsx(n.button,{type:"button",onClick:()=>P(!m),whileHover:{scale:1.2},whileTap:{scale:1.2},className:"absolute right-3 lg:bottom-4 bottom-3 text-[#8a4fff] opacity-70",children:m?s.jsx(R,{className:"w-4 h-4 sm:w-5 sm:h-5"}):s.jsx(U,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]}),a==="forgot-password"&&s.jsxs("div",{className:"relative",children:[s.jsx(D,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-[#8a4fff] opacity-70 w-4 h-4 sm:w-5 sm:h-5"}),s.jsx("input",{type:"email",placeholder:"Enter your email",required:!0,value:i,onChange:e=>{S(e.target.value),t(null)},className:`w-full pl-10 sm:pl-10 pr-4 py-2.5 sm:py-3 rounded-lg bg-[#2c1b4a] border border-[#8a4fff]/20 text-white text-[14px] sm:text-base
                      focus:outline-none focus:border-[#8a4fff] transition-all duration-300`})]}),s.jsxs(n.button,{...J,type:"submit",disabled:x,className:`
                  w-full bg-gradient-to-r from-[#8a4fff] to-[#5e3c9b] 
                  text-white py-2.5 sm:py-3 rounded-lg text-[14px] sm:text-base
                  flex items-center justify-center
                  hover:opacity-90 transition-opacity
                  ${x?"opacity-50 cursor-not-allowed":""}
                `,children:[x?"Processing...":a==="signin"?"Sign In":a==="signup"?"Create Account":"Send Reset Link",!x&&s.jsx(se,{className:"ml-2 w-4 h-4 sm:w-5 sm:h-5"})]}),a==="signin"&&s.jsx("div",{className:"text-center",children:s.jsx(n.button,{type:"button",onClick:B,disabled:x,whileHover:{scale:1.05},whileTap:{scale:.95},className:"text-[#8a4fff] text-[13px] sm:text-sm hover:underline",children:"Forgot Password?"})})]}),s.jsxs(n.div,{initial:{opacity:1},animate:{opacity:1},transition:{delay:.4},className:"bg-[#2c1b4a] border-t border-[#8a4fff]/10 p-4 sm:p-4 text-center",children:[a==="signin"&&s.jsxs("p",{className:"text-gray-400 text-[14px] sm:text-base",children:["Don't have an account?"," ",s.jsx(n.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>d("signup"),className:"text-[#8a4fff] hover:underline",children:"Sign Up"})]}),a==="signup"&&s.jsxs("p",{className:"text-gray-400 text-[14px] sm:text-base",children:["Already have an account?"," ",s.jsx(n.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>d("signin"),className:"text-[#8a4fff] hover:underline",children:"Sign In"})]}),a==="forgot-password"&&s.jsxs("p",{className:"text-gray-400 text-[13px] sm:text-base",children:["Remember your password?"," ",s.jsx(n.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>d("signin"),className:"text-[#8a4fff] hover:underline",children:"Sign In"})]})]})]})]})})]})};export{ne as default};
