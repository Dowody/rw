import{c as ce,b as le,u as de,r,j as e,l as w,C as me,m as p,T as xe,n as ue,g as fe,o as M,G as pe,L as j,S as he,s as c,d as be,e as ge,f as ye}from"./index-jAtxickh.js";import{C as G}from"./credit-card-B7BVvdNP.js";import{F as we}from"./file-text-C1q_lSxn.js";import{S as je}from"./shield-check-NBewcrPt.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=ce("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),Fe=()=>{const{cart:n,removeFromCart:R,getTotalPrice:Y,updateQuantity:ve,clearCart:$}=le(),u=de(),[U,T]=r.useState(""),[Se,z]=r.useState(!1),[ke,_e]=r.useState("bitcoin"),[Ce,H]=r.useState(!1),[b,i]=r.useState(null),[J,N]=r.useState(!0),[W,v]=r.useState(!1),[l,E]=r.useState(!1),[K,I]=r.useState(!1);r.useEffect(()=>{n.filter(o=>o.id==="monthly"||o.id==="6-months"||o.id==="yearly"||o.id==="free-trial").length>1?i("You can only have one subscription in your cart at a time. Please remove any additional subscriptions before proceeding."):i(null)},[n]);const O=r.useMemo(()=>Y(),[n]),g=r.useMemo(()=>O,[O]),[De,Pe]=r.useState([{id:"skinport",name:"Skinport",logo:e.jsx(w,{className:"w-10 h-10 text-green-500"}),status:"coming_soon",description:"Popular skin trading platform"},{id:"dmarket",name:"DMarket",logo:e.jsx(w,{className:"w-10 h-10 text-blue-500"}),status:"coming_soon",description:"Global skin marketplace"},{id:"bitskins",name:"BitSkins",logo:e.jsx(w,{className:"w-10 h-10 text-purple-500"}),status:"coming_soon",description:"Trusted skin trading platform"}]),[Q,V]=r.useState({id:"bitcoin",name:"Bitcoin",type:"crypto"}),X=[{id:"bitcoin",name:"Bitcoin",icon:e.jsx(be,{className:"lg:w-10 lg:h-10 w-7 h-7 text-[#F7931A]"}),type:"crypto"},{id:"ethereum",name:"Ethereum",icon:e.jsx(ge,{className:"lg:w-10 lg:h-10 w-7 h-7 text-[#627EEA]"}),type:"crypto"},{id:"tether",name:"Tether",icon:e.jsx(ye,{className:"lg:w-10 lg:h-10 w-7 h-7 text-[#26A17B]"}),type:"crypto"},{id:"skins",name:"Skins",icon:e.jsx(M,{className:"w-7 h-7 text-[#1B2838]"}),type:"skin"}],[S,k]=r.useState(!1),[Z,ee]=r.useState(!1);r.useEffect(()=>{(async()=>{try{const{data:{session:o}}=await c.auth.getSession();if(!o){u("/signin",{state:{from:"/checkout",message:"Please sign in to complete your purchase"}}),N(!1);return}H(!0);const{data:{user:f}}=await c.auth.getUser();f&&T(f.email||"");const s=location.state;if(n.length===0&&(s!=null&&s.message)&&u("/dashboard",{state:{section:"purchases",message:s.message}}),f){const{data:a}=await c.from("users").select("subscription_end_date").eq("auth_id",f.id).single();a&&a.subscription_end_date&&new Date(a.subscription_end_date)>new Date?(k(!0),i("You already have an active subscription. You cannot purchase another until your current subscription expires.")):k(!1)}window.history.replaceState({},document.title),N(!1)}catch(o){console.error("Authentication check failed:",o),i("Failed to verify authentication. Please try again."),N(!1)}})()},[u,n]);const te=n.some(t=>t.id==="free-trial"),A=async()=>{var o,f;if(n.filter(s=>s.id==="monthly"||s.id==="6-months"||s.id==="yearly"||s.id==="free-trial").length>1){i("Only one subscription is allowed at a time. Please remove one of your subscriptions from the cart.");return}if(S){i("You already have an active subscription. You cannot purchase another until your current subscription expires.");return}try{const{data:{user:s}}=await c.auth.getUser();if(!s){i("User not authenticated");return}let a=await c.from("users").select(`
          id, 
          current_subscription_id, 
          subscription_start_date, 
          subscription_end_date
        `).eq("auth_id",s.id).single();if(a.error||!a.data){const{data:d,error:P}=await c.from("users").insert({auth_id:s.id,email:s.email||"",username:((o=s.user_metadata)==null?void 0:o.username)||((f=s.email)==null?void 0:f.split("@")[0]),created_at:new Date().toISOString()}).select().single();if(P){console.error("User profile creation error:",P),i("Failed to create user profile");return}a={data:d,error:null,count:1,status:200,statusText:"OK"}}if(!a.data){i("Failed to get user data");return}const F={"1 Month Licence":{name:"1 Month Subscription",duration:1},"6 Months Licence":{name:"6 Months Subscription",duration:6},"12 Months Licence":{name:"12 Months Subscription",duration:12}},y=n[0].name,_=F[y]||{name:y,duration:1},{data:C,error:L}=await c.from("subscriptions").select("id, name, duration_days, price").or(`name.ilike.%${_.name}%,name.eq.${_.name}`);if(L){console.error("Subscription lookup error:",L),i("Could not find a matching subscription");return}if(!C||C.length===0){console.error("No matching subscription found",{cartItemName:y,mappedSubscriptionName:_.name}),i("No suitable subscription found. Please contact support.");return}const m=C[0];let D=m.id,x=new Date,h=new Date;if(a.data.current_subscription_id){const{data:d,error:P}=await c.from("subscriptions").select("id, name, duration_days, price").eq("id",a.data.current_subscription_id).single();if(d&&m.duration_days>d.duration_days){const ie=a.data.subscription_end_date?new Date(a.data.subscription_end_date):new Date,ne=Math.ceil((ie.getTime()-new Date().getTime())/(1e3*60*60*24)),oe=m.price/m.duration_days*ne,Te=g-oe;x=new Date,h=new Date(x),h.setDate(x.getDate()+m.duration_days)}else D=a.data.current_subscription_id,x=new Date(a.data.subscription_start_date||new Date),h=new Date(a.data.subscription_end_date||new Date)}else h=n[0].id==="free-trial"?new Date(x.getTime()+2*24*60*60*1e3):new Date(x.setDate(x.getDate()+m.duration_days));const Me=n.map(d=>({id:d.id,name:d.name,price:d.price,quantity:d.quantity})),{data:re,error:B}=await c.from("orders").insert({user_id:a.data.id,subscription_id:D,total_amount:g,transaction_date:new Date().toISOString(),status:"completed",items:[{id:m.id,name:m.name,price:g,quantity:1}]}).select().single();if(B){console.error("Order creation error:",B),i("Failed to process order. Please try again.");return}if(!re){i("Failed to create order. Please try again.");return}const{error:q}=await c.from("users").update({current_subscription_id:D,subscription_start_date:x.toISOString(),subscription_end_date:h.toISOString()}).eq("id",a.data.id);if(q){console.error("Subscription update error:",q),i("Failed to update subscription. Please contact support.");return}z(!0),$(),localStorage.setItem("showPurchaseSuccess","true"),localStorage.setItem("newSubscription","true"),u("/dashboard",{state:{section:"purchases",message:"Purchase completed successfully! Your subscription is now active.",showCongrats:!0}})}catch(s){console.error("Order placement error:",s),i("An unexpected error occurred. Please try again.")}},se=()=>e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs(p.div,{initial:{opacity:1,scale:.9},animate:{opacity:1,scale:1},className:"bg-[#0a0415] rounded-2xl p-8 max-w-md w-full border border-[#8a4fff]/10",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(we,{className:"w-8 h-8 text-[#8a4fff] mr-4"}),e.jsx("h2",{className:"text-2xl font-semibold text-[#8a4fff]",children:"Policy Acknowledgment"})]}),e.jsxs("div",{className:"mb-6 text-gray-300 space-y-4",children:[e.jsx("p",{children:"Before completing your purchase, please review and acknowledge our:"}),e.jsxs("ul",{className:"list-disc list-inside",children:[e.jsx("li",{children:e.jsx(j,{to:"/terms",target:"_blank",className:"text-[#8a4fff] hover:underline",children:"Terms of Service"})}),e.jsx("li",{children:e.jsx(j,{to:"/privacy",target:"_blank",className:"text-[#8a4fff] hover:underline",children:"Privacy Policy"})}),e.jsx("li",{children:e.jsx(j,{to:"/refund",target:"_blank",className:"text-[#8a4fff] hover:underline",children:"Refund Policy"})})]})]}),e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("input",{type:"checkbox",id:"policy-acknowledge",checked:l,onChange:()=>E(!l),className:"mr-3 w-5 h-5 text-[#8a4fff] rounded focus:ring-[#8a4fff]"}),e.jsx("label",{htmlFor:"policy-acknowledge",className:"text-gray-300",children:"I have read and agree to the terms and conditions."})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{onClick:()=>I(!1),className:"flex-1 py-3 bg-transparent border border-[#8a4fff]/30 text-[#8a4fff] rounded-lg",children:"Cancel"}),e.jsx("button",{onClick:()=>{l&&(I(!1),A())},disabled:!l,className:`
              flex-1 py-3 rounded-lg
              ${l?"bg-[#8a4fff] text-white":"bg-gray-500 text-gray-300 cursor-not-allowed"}
            `,children:"Confirm"})]})]})}),ae=()=>e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 overflow-y-auto",children:e.jsxs(p.div,{initial:{opacity:1,scale:.9},animate:{opacity:1,scale:1},className:"bg-[#0a0415] rounded-2xl p-4 sm:p-8 max-w-3xl w-full border border-[#8a4fff]/10 my-4 sm:my-8",children:[e.jsx("div",{className:"flex items-center mb-4 sm:mb-6 sticky top-0 bg-[#0a0415] z-10",children:e.jsx("h2",{className:"text-[20px] sm:text-2xl font-semibold text-[#8a4fff] m-auto",children:"Skin Transfer Marketplaces"})}),e.jsxs("div",{className:"mb-4 sm:mb-6 text-gray-300 space-y-3 sm:space-y-4",children:[e.jsx("p",{className:"text-center text-[14px] sm:text-base",children:"Select a marketplace to transfer your skins seamlessly."}),e.jsx("div",{className:"grid md:grid-cols-3 gap-3 sm:gap-4",children:[{id:"bitskins",name:"BitSkins",logo:e.jsx(w,{className:"w-5 h-5 sm:w-6 sm:h-6 text-purple-500"}),description:"Trusted skin trading platform",url:"https://bitskins.com/",status:"active"},{id:"tradeit",name:"TradeIt.gg",logo:e.jsx(M,{className:"w-5 h-5 sm:w-6 sm:h-6 text-[#1B2838]"}),description:"Instant skin trading platform",url:"https://tradeit.gg/",status:"active"}].map(t=>e.jsxs(p.div,{whileHover:{scale:1.05},whileTap:{scale:.95},className:`
                  bg-[#2c1b4a] rounded-xl p-4 sm:p-6 text-center relative
                  transition-all duration-300 
                  ${t.status==="active"?"hover:border-[#8a4fff] border border-transparent":"opacity-50 cursor-not-allowed"}
                `,children:[e.jsx("div",{className:"flex justify-center mb-3 sm:mb-4",children:t.logo}),e.jsx("h3",{className:"text-[16px] sm:text-lg font-semibold mb-2 text-white",children:t.name}),e.jsx("p",{className:"text-gray-400 text-[12px] sm:text-sm mb-3 sm:mb-4",children:t.description}),e.jsx("button",{onClick:()=>{t.status==="active"&&window.open(t.url,"_blank","noopener,noreferrer")},disabled:t.status!=="active",className:`
                    w-full py-2 sm:py-3 rounded-lg transition-colors text-[12px] sm:text-sm
                    ${t.status==="active"?"bg-[#8a4fff] text-white hover:bg-[#7a3ddf]":"bg-gray-500 text-gray-300 cursor-not-allowed"}
                  `,children:t.status==="active"?"Open Marketplace":"Coming Soon"})]},t.id))})]}),e.jsxs("div",{className:"flex items-center space-x-2 bg-[#2c1b4a] p-3 sm:p-4 rounded-xl mb-4 sm:mb-6",children:[e.jsx(je,{className:"w-5 h-5 sm:w-6 sm:h-6 text-green-500"}),e.jsx("p",{className:"text-[12px] sm:text-sm text-gray-300",children:"We recommend using trusted marketplaces and verifying trade details."})]}),e.jsxs("div",{className:"flex space-x-3 sm:space-x-4",children:[e.jsx("button",{onClick:()=>v(!1),className:"flex-1 py-2 sm:py-3 bg-transparent border border-[#8a4fff]/30 text-[#8a4fff] rounded-lg text-[14px] sm:text-sm",children:"Close"}),e.jsx("button",{onClick:()=>{window.open("/contact","_blank"),v(!1)},className:"flex-1 py-2 sm:py-3 bg-[#8a4fff] text-white rounded-lg hover:bg-[#7a3ddf] text-[14px] sm:text-sm",children:"Contact Support"})]})]})});if(J){const t=location.state;return e.jsxs("div",{className:"min-h-screen bg-[#04011C] flex items-center justify-center",children:[(t==null?void 0:t.message)&&e.jsx("div",{className:"absolute top-20 w-full max-w-md",children:e.jsxs("div",{className:"bg-emerald-500/10 border border-emerald-500 text-emerald-400 p-4 rounded-xl flex items-center",children:[e.jsx(me,{className:"mr-3 w-6 h-6"}),t.message]})}),e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 "})]})}return n.length===0?(u("/dashboard",{state:{section:"purchases"}}),null):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"min-h-screen bg-[#04011C] py-8 sm:py-16 px-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs(p.div,{initial:{opacity:1,y:0},animate:{opacity:1,y:0},transition:{duration:.4},className:"flex items-center mt-6 sm:mt-10",children:[e.jsxs("button",{onClick:()=>u("/"),className:"text-gray-400 hover:text-[#8a4fff] flex items-center mr-auto mb-12 sm:mb-20",children:[e.jsx(Ne,{className:"mr-2  w-5 h-5 mt-5 sm:w-6 sm:h-6"}),e.jsx("span",{className:"text-[14px] sm:text-base mt-5",children:"Back"})]}),e.jsx("h1",{className:"text-[24px] sm:text-3xl font-bold text-white absolute  mt-2 left-1/2 transform -translate-x-1/2 pt-4",children:"Checkout"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 sm:gap-8",children:[e.jsxs(p.div,{initial:{opacity:1,x:0},animate:{opacity:1,x:0},transition:{duration:.5,delay:.2},className:"space-y-4 sm:space-y-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-[#210746] to-[#2C095D] rounded-2xl sm:rounded-3xl p-4 sm:p-8 border border-[#8a4fff]/10",children:[e.jsxs("h2",{className:"text-[18px] sm:text-xl font-semibold text-[#8a4fff] mb-4 sm:mb-6 flex items-center",children:[e.jsx(G,{className:"mr-2 sm:mr-3 w-5 h-5 sm:w-6 sm:h-6"})," Your Items"]}),e.jsx("div",{className:"space-y-3 sm:space-y-4",children:n.map(t=>e.jsxs("div",{className:"flex justify-between items-center pb-3 sm:pb-4 border-b border-[#8a4fff]/10 last:border-b-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-[16px] sm:text-lg font-bold text-white",children:t.name}),e.jsxs("p",{className:"text-gray-400 text-[12px] sm:text-sm",children:[t.id==="free-trial"&&"CSGORoll Script",t.id==="monthly"&&"CSGORoll Script",t.id==="6-months"&&"CSGORoll Script",t.id==="yearly"&&"CSGORoll Script"]})]}),e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-4",children:[e.jsxs("span",{className:"text-[16px] sm:text-lg font-bold text-[#8a4fff] mr-2",children:["€",t.price.toFixed(2)]}),e.jsx("button",{onClick:()=>R(t.id),className:"text-red-500 hover:text-red-400",children:e.jsx(xe,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]},t.id))}),b&&e.jsxs("div",{className:"mt-4 bg-red-500/10 border border-red-500 text-red-400 p-3 rounded-xl flex items-center",children:[e.jsx(ue,{className:"mr-2 w-5 h-5"}),e.jsx("span",{className:"text-[14px]",children:b})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-[#210746] to-[#2C095D] rounded-2xl sm:rounded-3xl p-4 sm:p-8 border border-[#8a4fff]/10",children:[e.jsxs("h2",{className:"text-[18px] sm:text-xl font-semibold text-[#8a4fff] mb-4 sm:mb-6 flex items-center",children:[e.jsx(fe,{className:"mr-2 sm:mr-3 w-5 h-5 sm:w-6 sm:h-6"})," Payment Method"]}),e.jsx("div",{className:"grid grid-cols-3 gap-2 sm:gap-4",children:X.slice(0,3).map(t=>e.jsxs("button",{onClick:()=>{V({id:t.id,name:t.name,type:t.type})},className:`
                        flex flex-col items-center justify-center p-2 sm:p-4 rounded-xl
                        ${Q.id===t.id?"bg-[#8a4fff]/10 border-2 border-[#8a4fff]":"bg-[#1a0b2e] border-2 border-transparent"}
                        transition-all duration-300 hover:bg-[#8a4fff]/10
                      `,children:[e.jsx("div",{className:"w-6 h-6 sm:w-10 sm:h-10 mr-1 lg:mr-[-1px]",children:t.icon}),e.jsx("span",{className:"mt-2 sm:mt-3 text-[12px] sm:text-sm text-white",children:t.name})]},t.id))}),e.jsxs("div",{className:"mt-4 sm:mt-6 bg-[#2c1b4a] rounded-xl p-4 sm:p-4 border border-[#8a4fff]/20",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2 sm:mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[e.jsx(M,{className:"w-5 h-5 sm:w-6 sm:h-6 text-[#8a4fff]"}),e.jsx("h3",{className:"text-[18px] sm:text-[20px] font-semibold text-[#8a4fff]",children:"Skin Payment"})]}),e.jsx("span",{className:"bg-yellow-500/20 text-yellow-400 text-[10px] sm:text-xs px-2 py-1 rounded-full",children:"Coming Soon"})]}),e.jsx("p",{className:"text-gray-300 mb-2 sm:mb-3 text-[14px] sm:text-base",children:"We're working on integrating multiple skin marketplaces for seamless trading."}),e.jsxs("button",{onClick:()=>v(!0),className:`w-full bg-[#8a4fff]/10 text-[#8a4fff] 
                    py-2 sm:py-3 rounded-lg hover:bg-[#8a4fff]/20 
                    transition-colors mt-4 flex items-center justify-center text-[14px] sm:text-base`,children:[e.jsx(pe,{className:"mr-2 w-4 h-4 sm:w-5 sm:h-5"}),"Learn More About Skin Payments"]})]})]})]}),e.jsxs(p.div,{initial:{opacity:1,x:0},animate:{opacity:1,x:0},transition:{duration:.5,delay:.2},className:"bg-gradient-to-br from-[#210746] to-[#2C095D] rounded-2xl sm:rounded-3xl p-4 sm:p-8 border border-[#8a4fff]/10 h-fit",children:[e.jsxs("h2",{className:"text-[18px] sm:text-xl font-semibold text-[#8a4fff] mb-4 sm:mb-6 flex items-center",children:[e.jsx(G,{className:"mr-2 sm:mr-3 w-5 h-5 sm:w-6 sm:h-6"})," Order Summary"]}),e.jsx("div",{className:"space-y-3 sm:space-y-4 mb-6 sm:mb-8",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400 text-[14px] sm:text-base",children:"Total"}),e.jsxs("span",{className:"text-[18px] sm:text-2xl font-bold text-[#8a4fff]",children:["€",g.toFixed(2)]})]})}),e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("label",{className:"block text-[12px] sm:text-sm text-gray-400 mb-2",children:"Email Address"}),e.jsx("input",{type:"email",value:U,onChange:t=>{T(t.target.value),i(null)},placeholder:"Enter your email",className:`w-full p-2.5 sm:p-3 bg-[#1a0b2e] rounded-xl text-[14px] sm:text-base text-white 
                  border border-[#8a4fff]/20 focus:border-[#8a4fff] 
                  transition-colors`})]}),e.jsxs("div",{className:"mb-4 sm:mb-6 flex items-center",children:[e.jsx("input",{type:"checkbox",id:"policy-checkbox",checked:l,onChange:()=>E(!l),className:"mr-2 sm:mr-3 w-4 h-4 sm:w-5 sm:h-5 text-[#8a4fff] rounded focus:ring-[#8a4fff]"}),e.jsxs("label",{htmlFor:"policy-checkbox",className:"text-gray-400 flex items-center text-[14px] sm:text-sm",children:["I've read and accept the"," ",e.jsx(j,{to:"/policy",className:"ml-1 text-[#8a4fff] hover:underline",children:"Policies"})]})]}),e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[te&&!Z?e.jsxs("button",{onClick:()=>{window.open("https://discord.gg/rollwithdraw","_blank","noopener,noreferrer"),ee(!0)},className:"w-full py-3 sm:py-4 bg-[#5865F2] text-white rounded-xl hover:bg-[#4752C4] transition-colors text-[14px] sm:text-lg flex items-center justify-center",children:[e.jsx(he,{className:"w-5 h-5 sm:w-6 sm:h-6 mr-2"}),"Join Discord"]}):e.jsx("button",{onClick:A,disabled:!l||b!==null||S,className:`
                      w-full py-3 sm:py-4 rounded-xl transition-colors text-[14px] sm:text-lg
                      ${l&&!b&&!S?"bg-[#8a4fff] text-white hover:bg-[#7a3ddf]":"bg-gray-500 text-gray-300 cursor-not-allowed"}
                    `,children:"Place Order"}),e.jsx("button",{onClick:()=>u("/"),className:`w-full py-3 sm:py-4 bg-transparent border border-[#8a4fff]/30 
                    text-[#8a4fff] rounded-xl hover:bg-[#8a4fff]/10 
                    transition-colors text-[14px] sm:text-lg`,children:"Cancel"})]})]})]})]})}),K&&e.jsx(se,{}),W&&e.jsx(ae,{})]})};export{Fe as default};
