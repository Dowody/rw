import{c as oe,b as le,u as ce,r as s,j as e,h as p,m as d,M as de,P as me,T as xe,i as _,G as B,L as j,s as l,e as fe,f as ue,g as he}from"./index-yd9Elw_3.js";import{C as q}from"./check-circle-C-jV6Fng.js";import{C as P}from"./credit-card-DEUla6V1.js";import{A as pe}from"./alert-triangle-u2U3i5Xp.js";import{L as be}from"./lock-BLUyo0ms.js";import{F as ge}from"./file-text-eFcpkAr-.js";import{S as je}from"./shield-check-p7xIOH3y.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=oe("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),Fe=()=>{const{cart:m,removeFromCart:$,getTotalPrice:R,updateQuantity:M,clearCart:U}=le(),c=ce(),[G,D]=s.useState(""),[z,Ne]=s.useState(!1),[Y,we]=s.useState("bitcoin"),[ve,H]=s.useState(!1),[A,r]=s.useState(null),[W,y]=s.useState(!0),[K,N]=s.useState(!1),[n,E]=s.useState(!1),[Q,T]=s.useState(!1),h=s.useMemo(()=>R(),[m]),J=s.useMemo(()=>h*.1,[h]),w=s.useMemo(()=>h*1.1,[h]),[ke,Se]=s.useState([{id:"skinport",name:"Skinport",logo:e.jsx(p,{className:"w-10 h-10 text-green-500"}),status:"coming_soon",description:"Popular skin trading platform"},{id:"dmarket",name:"DMarket",logo:e.jsx(p,{className:"w-10 h-10 text-blue-500"}),status:"coming_soon",description:"Global skin marketplace"},{id:"bitskins",name:"BitSkins",logo:e.jsx(p,{className:"w-10 h-10 text-purple-500"}),status:"coming_soon",description:"Trusted skin trading platform"}]),[V,X]=s.useState({id:"bitcoin",name:"Bitcoin",type:"crypto"}),Z=[{id:"bitcoin",name:"Bitcoin",icon:e.jsx(fe,{className:"w-10 h-10 text-[#F7931A]"}),type:"crypto"},{id:"ethereum",name:"Ethereum",icon:e.jsx(ue,{className:"w-10 h-10 text-[#627EEA]"}),type:"crypto"},{id:"tether",name:"Tether",icon:e.jsx(he,{className:"w-10 h-10 text-[#26A17B]"}),type:"crypto"},{id:"skins",name:"Skins",icon:e.jsx(_,{className:"w-10 h-10 text-[#1B2838]"}),type:"skin"}];s.useEffect(()=>{(async()=>{try{const{data:{session:f}}=await l.auth.getSession();if(!f){c("/signin",{state:{from:"/checkout",message:"Please sign in to complete your purchase"}}),y(!1);return}H(!0);const{data:{user:i}}=await l.auth.getUser();i&&D(i.email||""),m.length===0&&c("/dashboard",{state:{section:"purchases",message:"Purchase completed successfully! Your subscription is now active."}}),window.history.replaceState({},document.title),y(!1)}catch(f){console.error("Authentication check failed:",f),r("Failed to verify authentication. Please try again."),y(!1)}})()},[c,m]);const F=async()=>{var t,f;try{const{data:{user:i}}=await l.auth.getUser();if(!i){r("User not authenticated");return}let a=await l.from("users").select(`
          id, 
          current_subscription_id, 
          subscription_start_date, 
          subscription_end_date
        `).eq("auth_id",i.id).single();if(a.error||!a.data){const{data:o,error:g}=await l.from("users").insert({auth_id:i.id,email:i.email||"",username:((t=i.user_metadata)==null?void 0:t.username)||((f=i.email)==null?void 0:f.split("@")[0]),created_at:new Date().toISOString()}).select().single();if(g){console.error("User profile creation error:",g),r("Failed to create user profile");return}a={data:o,error:null,count:1,status:200,statusText:"OK"}}if(!a.data){r("Failed to get user data");return}const se={"1 Month Licence":{name:"1 Month Subscription",duration:1},"6 Months Licence":{name:"6 Months Subscription",duration:6},"12 Months Licence":{name:"12 Months Subscription",duration:12}},v=m[0].name,k=se[v]||{name:v,duration:1},{data:S,error:O}=await l.from("subscriptions").select("id, name, duration_months, price").or(`name.ilike.%${k.name}%,name.eq.${k.name}`);if(O){console.error("Subscription lookup error:",O),r("Could not find a matching subscription");return}if(!S||S.length===0){console.error("No matching subscription found",{cartItemName:v,mappedSubscriptionName:k.name}),r("No suitable subscription found. Please contact support.");return}const u=S[0];let C=u.id,x=new Date,b=new Date;if(a.data.current_subscription_id){const{data:o}=await l.from("subscriptions").select("id, name, duration_months, price").eq("id",a.data.current_subscription_id).single();if(o&&u.duration_months>o.duration_months){const g=new Date(a.data.subscription_end_date||new Date),ie=Math.max(0,(g.getTime()-new Date().getTime())/(30*24*60*60*1e3)),ne=u.price/u.duration_months*ie,Ce=w-ne;x=new Date,b=new Date(x.setMonth(x.getMonth()+u.duration_months))}else C=a.data.current_subscription_id,x=new Date(a.data.subscription_start_date||new Date),b=new Date(a.data.subscription_end_date||new Date)}else b=new Date(x.setMonth(x.getMonth()+u.duration_months));const ae=m.map(o=>({id:o.id,name:o.name,price:o.price,quantity:o.quantity})),{data:re,error:I}=await l.from("orders").insert({user_id:a.data.id,subscription_id:C,total_amount:w,items:ae,payment_method:Y,status:"pending"}).select().single();if(I){console.error("Order creation error:",I),r("Failed to process order. Please try again.");return}if(!re){r("Failed to create order. Please try again.");return}const{error:L}=await l.from("users").update({current_subscription_id:C,subscription_start_date:x.toISOString(),subscription_end_date:b.toISOString()}).eq("id",a.data.id);if(L){console.error("Subscription update error:",L),r("Failed to update subscription. Please contact support.");return}U(),c("/dashboard",{state:{section:"purchases",message:"Order completed successfully!"}})}catch(i){console.error("Order placement error:",i),r("An unexpected error occurred. Please try again.")}},ee=()=>e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs(d.div,{initial:{opacity:1,scale:.9},animate:{opacity:1,scale:1},className:"bg-[#0a0415] rounded-2xl p-8 max-w-md w-full border border-[#8a4fff]/10",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(ge,{className:"w-8 h-8 text-[#8a4fff] mr-4"}),e.jsx("h2",{className:"text-2xl font-semibold text-[#8a4fff]",children:"Policy Acknowledgment"})]}),e.jsxs("div",{className:"mb-6 text-gray-300 space-y-4",children:[e.jsx("p",{children:"Before completing your purchase, please review and acknowledge our:"}),e.jsxs("ul",{className:"list-disc list-inside",children:[e.jsx("li",{children:e.jsx(j,{to:"/terms",target:"_blank",className:"text-[#8a4fff] hover:underline",children:"Terms of Service"})}),e.jsx("li",{children:e.jsx(j,{to:"/privacy",target:"_blank",className:"text-[#8a4fff] hover:underline",children:"Privacy Policy"})}),e.jsx("li",{children:e.jsx(j,{to:"/refund",target:"_blank",className:"text-[#8a4fff] hover:underline",children:"Refund Policy"})})]})]}),e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("input",{type:"checkbox",id:"policy-acknowledge",checked:n,onChange:()=>E(!n),className:"mr-3 w-5 h-5 text-[#8a4fff] rounded focus:ring-[#8a4fff]"}),e.jsx("label",{htmlFor:"policy-acknowledge",className:"text-gray-300",children:"I have read and agree to the terms and conditions."})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{onClick:()=>T(!1),className:"flex-1 py-3 bg-transparent border border-[#8a4fff]/30 text-[#8a4fff] rounded-lg",children:"Cancel"}),e.jsx("button",{onClick:()=>{n&&(T(!1),F())},disabled:!n,className:`
              flex-1 py-3 rounded-lg
              ${n?"bg-[#8a4fff] text-white":"bg-gray-500 text-gray-300 cursor-not-allowed"}
            `,children:"Confirm"})]})]})}),te=()=>e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 overflow-y-auto",children:e.jsxs(d.div,{initial:{opacity:1,scale:.9},animate:{opacity:1,scale:1},className:"bg-[#0a0415] rounded-2xl p-8 max-w-3xl w-full border border-[#8a4fff]/10 my-8",children:[e.jsxs("div",{className:"flex items-center mb-6 sticky top-0 bg-[#0a0415] z-10",children:[e.jsx(B,{className:"w-8 h-8 text-[#8a4fff] mr-4"}),e.jsx("h2",{className:"text-2xl font-semibold text-[#8a4fff]",children:"Skin Transfer Marketplaces"})]}),e.jsxs("div",{className:"mb-6 text-gray-300 space-y-4",children:[e.jsx("p",{className:"text-center",children:"Select a marketplace to transfer your skins seamlessly."}),e.jsx("div",{className:"grid md:grid-cols-3 gap-4",children:[{id:"skinport",name:"Skinport",logo:e.jsx(p,{className:"w-6 h-6 text-green-500"}),description:"Popular skin trading platform",url:"https://skinport.com/trade",status:"active"},{id:"bitskins",name:"BitSkins",logo:e.jsx(p,{className:"w-6 h-6 text-purple-500"}),description:"Trusted skin trading platform",url:"https://bitskins.com/",status:"active"},{id:"tradeit",name:"TradeIt.gg",logo:e.jsx(_,{className:"w-6 h-6 text-[#1B2838]"}),description:"Instant skin trading platform",url:"https://tradeit.gg/",status:"active"}].map(t=>e.jsxs(d.div,{whileHover:{scale:1.05},whileTap:{scale:.95},className:`
                  bg-[#2c1b4a] rounded-xl p-6 text-center relative
                  transition-all duration-300 
                  ${t.status==="active"?"hover:border-[#8a4fff] border border-transparent":"opacity-50 cursor-not-allowed"}
                `,children:[e.jsx("div",{className:"flex justify-center mb-4",children:t.logo}),e.jsx("h3",{className:"text-white font-semibold mb-2",children:t.name}),e.jsx("p",{className:"text-gray-400 text-sm mb-4",children:t.description}),e.jsx("button",{onClick:()=>{t.status==="active"&&window.open(t.url,"_blank","noopener,noreferrer")},disabled:t.status!=="active",className:`
                    w-full py-3 rounded-lg transition-colors
                    ${t.status==="active"?"bg-[#8a4fff] text-white hover:bg-[#7a3ddf]":"bg-gray-500 text-gray-300 cursor-not-allowed"}
                  `,children:t.status==="active"?"Open Marketplace":"Coming Soon"})]},t.id))})]}),e.jsxs("div",{className:"flex items-center space-x-2 bg-[#2c1b4a] p-4 rounded-xl mb-6",children:[e.jsx(je,{className:"w-6 h-6 text-green-500"}),e.jsx("p",{className:"text-sm text-gray-300",children:"We recommend using trusted marketplaces and verifying trade details."})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{onClick:()=>N(!1),className:"flex-1 py-3 bg-transparent border border-[#8a4fff]/30 text-[#8a4fff] rounded-lg",children:"Close"}),e.jsx("button",{onClick:()=>{window.open("/contact","_blank"),N(!1)},className:"flex-1 py-3 bg-[#8a4fff] text-white rounded-lg hover:bg-[#7a3ddf]",children:"Contact Support"})]})]})});if(W){const t=location.state;return e.jsxs("div",{className:"min-h-screen bg-[#04011C] flex items-center justify-center",children:[(t==null?void 0:t.message)&&e.jsx("div",{className:"absolute top-20 w-full max-w-md",children:e.jsxs("div",{className:"bg-emerald-500/10 border border-emerald-500 text-emerald-400 p-4 rounded-xl flex items-center",children:[e.jsx(q,{className:"mr-3 w-6 h-6"}),t.message]})}),e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 "})]})}return z?e.jsx("div",{className:"min-h-screen bg-[#04011C] flex items-center justify-center px-4 py-16",children:e.jsxs(d.div,{initial:{opacity:1,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5},className:"max-w-md w-full text-center bg-[#0a0415] rounded-3xl p-12 border border-[#8a4fff]/10",children:[e.jsx(q,{className:"w-32 h-32 mx-auto text-[#8a4fff] mb-8"}),e.jsx("h2",{className:"text-4xl font-bold text-white mb-6",children:"Order Confirmed"}),e.jsx("p",{className:"text-gray-400 mb-10 text-lg",children:"Your order has been successfully processed."}),e.jsx("button",{onClick:()=>c("/"),className:`w-full py-4 bg-[#8a4fff] 
            text-white rounded-xl hover:bg-[#7a3ddf] transition-colors text-lg`,children:"Return to Home"})]})}):m.length===0?e.jsx("div",{className:"min-h-screen bg-[#04011C] flex items-center justify-center px-4 py-16",children:e.jsxs(d.div,{initial:{opacity:1,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5},className:"max-w-md w-full text-center bg-[#0a0415] rounded-3xl p-12 border border-[#8a4fff]/10",children:[e.jsx("div",{className:"w-32 h-32 mx-auto mb-8 flex items-center justify-center bg-[#8a4fff]/10 rounded-full",children:e.jsx(P,{className:"w-16 h-16 text-[#8a4fff] opacity-70"})}),e.jsx("h2",{className:"text-4xl font-bold text-white mb-6",children:"Cart is Empty"}),e.jsx("p",{className:"text-gray-400 mb-10 text-lg",children:"Add items to get started"}),e.jsx("button",{onClick:()=>c("/"),className:`w-full py-4 bg-[#8a4fff] 
            text-white rounded-xl hover:bg-[#7a3ddf] transition-colors text-lg`,children:"Browse Products"})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"min-h-screen bg-[#04011C] py-16 px-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[A&&e.jsxs("div",{className:"bg-red-500/10 border border-red-500 text-red-400 p-4 rounded-xl mb-6 flex items-center",children:[e.jsx(pe,{className:"mr-3 w-6 h-6"}),A]}),e.jsxs(d.div,{initial:{opacity:1,y:0},animate:{opacity:1,y:0},transition:{duration:.4},className:"flex items-center mt-10",children:[e.jsxs("button",{onClick:()=>c("/"),className:"text-gray-400 hover:text-[#8a4fff] flex items-center mr-auto mb-20",children:[e.jsx(ye,{className:"mr-2 w-6 h-6"})," Back"]}),e.jsx("h1",{className:"text-3xl font-bold text-white absolute left-1/2 transform -translate-x-1/2 pt-0",children:"Checkout"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[e.jsxs(d.div,{initial:{opacity:1,x:0},animate:{opacity:1,x:0},transition:{duration:.5,delay:.2},className:"space-y-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-[#210746] to-[#2C095D] rounded-3xl p-8 border border-[#000000]/10",children:[e.jsxs("h2",{className:"text-xl font-semibold text-[#8a4fff] mb-6 flex items-center",children:[e.jsx(P,{className:"mr-3 w-6 h-6"})," Your Items"]}),e.jsx("div",{className:"space-y-4",children:m.map(t=>e.jsxs("div",{className:"flex justify-between items-center pb-4 border-b border-[#8a4fff]/10 last:border-b-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:t.name}),e.jsxs("p",{className:"text-gray-400 text-sm",children:[t.id==="monthly"&&"Monthly Subscription",t.id==="6-months"&&"CSGORoll Script",t.id==="annual"&&"Annual Subscription"]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center bg-[#1a0b2e] rounded-full",children:[e.jsx("button",{onClick:()=>M(t.id,t.quantity-1),className:"p-2 text-gray-400 hover:text-[#8a4fff]",children:e.jsx(de,{className:"w-4 h-4"})}),e.jsx("span",{className:"px-3 text-white",children:t.quantity}),e.jsx("button",{onClick:()=>M(t.id,t.quantity+1),className:"p-2 text-gray-400 hover:text-[#8a4fff]",children:e.jsx(me,{className:"w-4 h-4"})})]}),e.jsxs("span",{className:"text-lg font-bold text-[#8a4fff]",children:["€",(t.price*t.quantity).toFixed(2)]}),e.jsx("button",{onClick:()=>$(t.id),className:"text-red-500 hover:text-red-400",children:e.jsx(xe,{className:"w-5 h-5"})})]})]},t.id))})]}),e.jsxs("div",{className:"bg-gradient-to-br from-[#210746] to-[#2C095D] rounded-3xl p-8 border border-[#8a4fff]/10",children:[e.jsxs("h2",{className:"text-xl font-semibold text-[#8a4fff] mb-6 flex items-center",children:[e.jsx(be,{className:"mr-3 w-6 h-6"})," Payment Method"]}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:Z.slice(0,3).map(t=>e.jsxs("button",{onClick:()=>{X({id:t.id,name:t.name,type:t.type})},className:`
                      flex flex-col items-center justify-center p-4 rounded-xl
                        ${V.id===t.id?"bg-[#8a4fff]/10 border-2 border-[#8a4fff]":"bg-[#1a0b2e] border-2 border-transparent"}
                      transition-all duration-300 hover:bg-[#8a4fff]/10
                    `,children:[t.icon,e.jsx("span",{className:"mt-3 text-sm text-white",children:t.name})]},t.id))}),e.jsxs("div",{className:"mt-6 bg-[#2c1b4a] rounded-xl p-4 border border-[#8a4fff]/20",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(_,{className:"w-8 h-8 text-[#8a4fff]"}),e.jsx("h3",{className:"text-lg font-semibold text-[#8a4fff]",children:"Skin Payment"})]}),e.jsx("span",{className:"bg-yellow-500/20 text-yellow-400 text-xs px-2 py-1 rounded-full",children:"Coming Soon"})]}),e.jsx("p",{className:"text-gray-300 mb-4 text-sm",children:"We're working on integrating multiple skin marketplaces for seamless trading."}),e.jsxs("button",{onClick:()=>N(!0),className:`w-full bg-[#8a4fff]/10 text-[#8a4fff] 
                    py-3 rounded-lg hover:bg-[#8a4fff]/20 
                    transition-colors flex items-center justify-center`,children:[e.jsx(B,{className:"mr-2 w-5 h-5"}),"Learn More About Skin Payments"]})]})]})]}),e.jsxs(d.div,{initial:{opacity:1,x:0},animate:{opacity:1,x:0},transition:{duration:.5,delay:.2},className:"bg-gradient-to-br from-[#210746] to-[#2C095D] rounded-3xl p-8 border border-[#8a4fff]/10 h-fit",children:[e.jsxs("h2",{className:"text-xl font-semibold text-[#8a4fff] mb-6 flex items-center",children:[e.jsx(P,{className:"mr-3 w-6 h-6"})," Order Summary"]}),e.jsxs("div",{className:"space-y-4 mb-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Subtotal"}),e.jsxs("span",{className:"text-white font-semibold",children:["€",h.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Tax (10%)"}),e.jsxs("span",{className:"text-white",children:["€",J.toFixed(2)]})]}),e.jsx("div",{className:"border-t border-[#8a4fff]/10 my-4"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xl font-bold text-white",children:"Total"}),e.jsxs("span",{className:"text-2xl font-bold text-[#8a4fff]",children:["€",w.toFixed(2)]})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"Email Address"}),e.jsx("input",{type:"email",value:G,onChange:t=>{D(t.target.value),r(null)},placeholder:"Enter your email",className:`w-full p-3 bg-[#1a0b2e] rounded-xl text-white 
                border border-[#8a4fff]/20 focus:border-[#8a4fff] 
                transition-colors`})]}),e.jsxs("div",{className:"mb-6 flex items-center",children:[e.jsx("input",{type:"checkbox",id:"policy-checkbox",checked:n,onChange:()=>E(!n),className:"mr-3 w-5 h-5 text-[#8a4fff] rounded focus:ring-[#8a4fff]"}),e.jsxs("label",{htmlFor:"policy-checkbox",className:"text-gray-400 flex items-center",children:["I've read and accept the"," ",e.jsx(j,{to:"/policy",className:"ml-1 text-[#8a4fff] hover:underline",children:"Policies"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("button",{onClick:F,disabled:!n,className:`
                    w-full py-4 rounded-xl transition-colors text-lg
                    ${n?"bg-[#8a4fff] text-white hover:bg-[#7a3ddf]":"bg-gray-500 text-gray-300 cursor-not-allowed"}
                  `,children:"Place Order"}),e.jsx("button",{onClick:()=>c("/"),className:`w-full py-4 bg-transparent border border-[#8a4fff]/30 
                  text-[#00000] rounded-xl hover:bg-[#8a4fff]/10 
                transition-colors text-lg`,children:"Cancel"})]})]})]})]})}),Q&&e.jsx(ee,{}),K&&e.jsx(te,{})]})};export{Fe as default};
