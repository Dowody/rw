import{c as P,r as i,u as W,a as V,j as e,m as l,A as B,g as I,E as C,h as U,i as G,s as u}from"./index-BkKe4XNZ.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=P("AtSign",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=P("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=P("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),ee=()=>{const[c,S]=i.useState(""),[x,_]=i.useState(""),[w,L]=i.useState(""),[k,R]=i.useState(""),[n,d]=i.useState("signin"),[f,E]=i.useState(!1),[y,t]=i.useState(null),[v,p]=i.useState(!1),[Q,X]=i.useState(!1),h=W(),b=V();i.useEffect(()=>{(async()=>{const{data:{session:a}}=await u.auth.getSession();if(a){const r=b.state,o=(r==null?void 0:r.from)||"/dashboard";h(o,{replace:!0})}})()},[h,b]),i.useEffect(()=>{const s=b.state;if(s!=null&&s.message){if(t(s.message),s.message.includes("Log In or Sign Up")){const a=setTimeout(()=>{t(null)},5e3);return()=>clearTimeout(a)}}else{t("Log In or Sign Up to use RollWithdraw.");const a=setTimeout(()=>{t(null)},5e3);return()=>clearTimeout(a)}s!=null&&s.mode&&d(s.mode)},[b]);const N=s=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s),F=s=>/^[a-zA-Z0-9_]{3,16}$/.test(s),H=s=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{8,}$/.test(s),$=async()=>{if(!N(c)){t("Please enter a valid email address");return}p(!0);try{const{error:s}=await u.auth.resetPasswordForEmail(c,{redirectTo:"https://rollwithdraw.com/reset-password"});s?t(s.message):(t("Password reset link sent to your email"),d("signin"))}catch{t("Failed to send reset link. Please try again.")}finally{p(!1)}},q=async()=>{var s,a;if(!N(c)){t("Please enter a valid email address");return}p(!0);try{const{data:r,error:o}=await u.auth.signInWithPassword({email:c,password:w});if(o){switch(console.error("Signin Error:",{message:o.message,code:o.code,details:o.details}),o.code){case"invalid_grant":t("Invalid email or password. Please try again.");break;case"auth/user-not-found":t("No account found with this email. Please sign up.");break;case"auth/wrong-password":t("Incorrect password. Please try again.");break;default:t(o.message||"Authentication failed. Please try again.")}return}if(r.user)try{const{data:g,error:j}=await u.from("users").select("*").eq("auth_id",r.user.id).single();if(j){if(console.error("User fetch error:",{message:j.message,code:j.code,details:j.details}),!((s=r.user)!=null&&s.email)){t("Invalid user data. Please contact support.");return}const{error:A}=await u.from("users").insert({auth_id:r.user.id,email:r.user.email,username:((a=r.user.user_metadata)==null?void 0:a.username)||r.user.email.split("@")[0],created_at:new Date().toISOString(),status:"active",last_login:new Date().toISOString()});if(A){console.error("Profile creation error:",A),t("Failed to create user profile. Please contact support.");return}}const m=b.state,M=document.referrer;(m==null?void 0:m.from)==="/checkout"||m!=null&&m.from&&m.from.includes("#products")||M.includes("#products")?h("/checkout"):h("/dashboard"),window.dispatchEvent(new Event("authChange"))}catch(g){console.error("Profile retrieval error:",g),t("An unexpected error occurred. Please try again.")}else t("Authentication failed. Please try again.")}catch(r){console.error("Unexpected Signin Catch Error:",r),t("An unexpected error occurred. Please try again.")}finally{p(!1)}},D=async()=>{if(!F(x)){t("Username must be 3-16 characters, alphanumeric or underscores");return}if(!H(w)){t("Password must be at least 8 characters with uppercase, lowercase, and number");return}if(w!==k){t("Passwords do not match");return}p(!0);try{const{data:s,error:a}=await u.from("users").select("username").eq("username",x).maybeSingle();if(a){if(console.error("Username check error:",{code:a.code,message:a.message,details:a.details}),a.code==="42P01"){t("Database configuration error. Please contact support.");return}t("Error checking username availability");return}if(s){t("Username is already taken");return}const{data:r,error:o}=await u.auth.signUp({email:c,password:w,options:{data:{username:x,email_confirm:!0},emailRedirectTo:`${window.location.origin}/signin`}});if(o){console.error("Auth Signup Error:",{message:o.message,code:o.code,details:o.details}),t(o.message||"Failed to create account");return}if(r.user){const{error:g}=await u.from("users").insert({auth_id:r.user.id,email:r.user.email,username:x,created_at:new Date().toISOString(),status:"active"});g&&g.message&&g.message.includes('violates row-level security policy for table "users"')?(d("signin"),setTimeout(()=>{h("/signin",{state:{message:"Please open your email to confirm your account.",mode:"signin"}})},2e3)):(t("Account created successfully!"),setTimeout(()=>{h("/signin",{state:{message:"Please open your email to confirm your account.",mode:"signin"}})},2e3))}}catch(s){console.error("Unexpected Signup Error:",s),t("An unexpected error occurred. Please try again.")}finally{p(!1)}},O=async s=>{if(s.preventDefault(),t(null),!N(c)){t("Please enter a valid email address");return}switch(n){case"signin":await q();break;case"signup":await D();break;case"forgot-password":await $();break}},z={whileHover:{scale:1.05,transition:{type:"spring",stiffness:300}},whileTap:{scale:.95}},Z={initial:{opacity:1,scale:.95},in:{opacity:1,scale:1,transition:{duration:.3,ease:"easeOut"}},out:{opacity:1,scale:.95,transition:{duration:.2,ease:"easeIn"}}};return e.jsxs("div",{className:"min-h-screen relative h-[100vh] overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 h-[100vh]",children:[e.jsx("div",{style:{backgroundImage:"url(/rw/hero_bg.jpg)",backgroundSize:"cover",backgroundPosition:"center",width:"100%",height:"100vh",opacity:1,filter:"blur(8px)",transform:"scale(1.1)"}}),e.jsx("div",{style:{backgroundColor:"rgba(0, 0, 0, 0.6)",position:"absolute",top:0,left:0,right:0,bottom:0,width:"100%",height:"100vh"}})]}),e.jsx("div",{className:"relative z-10 min-h-screen w-full flex items-center justify-center px-4 py-8 sm:py-16",children:e.jsxs(l.div,{initial:"initial",animate:"in",exit:"out",variants:Z,className:"w-full max-w-md relative",children:[e.jsx(B,{children:y&&e.jsxs(l.div,{initial:{opacity:1,y:-20},animate:{opacity:1,y:0},exit:{opacity:1,y:-20},className:`absolute ${n==="signup"?"-top-[90px] sm:-top-[110px]":"-top-[80px] sm:-top-20"} left-0 right-0 p-3 sm:p-4 rounded-xl flex items-center justify-center ${y.includes("Log In or Sign Up")?"bg-purple-500/10 border border-purple-500 text-purple-400":y.includes("Account created successfully")?"bg-green-500/10 border border-green-500 text-green-400":"bg-red-500/10 border border-red-500 text-red-400"}`,children:[e.jsx(K,{className:"mr-2 sm:mr-3 w-5 h-5 sm:w-6 sm:h-6"}),e.jsx("span",{className:"text-[14px] sm:text-base text-center",children:y})]})}),e.jsxs("div",{className:"bg-gradient-to-br from-[#1a0b2e] to-[#130428] rounded-2xl shadow-2xl overflow-hidden",children:[e.jsx(l.div,{initial:{opacity:1},animate:{opacity:1},transition:{duration:.5},className:"flex border-b border-[#8a4fff]/10",children:["signin","signup","forgot-password"].map(s=>e.jsx(l.button,{onClick:()=>{d(s),t(null)},whileHover:{scale:1.05},whileTap:{scale:.95},className:`
                    flex-1 py-3 sm:py-4 text-[16px] sm:text-lg font-semibold transition-all duration-300
                    ${n===s?"bg-[#8a4fff]/10 text-[#8a4fff]":"text-gray-400 hover:bg-[#8a4fff]/5"}
                  `,children:s==="signin"?"Sign In":s==="signup"?"Sign Up":"Reset"},s))}),e.jsxs("form",{onSubmit:O,className:"p-6 sm:p-8 space-y-4 sm:space-y-6 ",children:[n!=="forgot-password"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx(T,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-[#8a4fff] opacity-70 w-4 h-4 sm:w-5 sm:h-5 "}),e.jsx("input",{type:"email",placeholder:"Email Address",required:!0,value:c,onChange:s=>{S(s.target.value),t(null)},className:`w-full pl-10 sm:pl-10 pr-4 py-2.5 sm:py-3 rounded-lg bg-[#2c1b4a] border border-[#8a4fff]/20 text-white text-[14px] sm:text-base
                        focus:outline-none focus:border-[#8a4fff] transition-all duration-300`})]}),n==="signup"&&e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-[#8a4fff] opacity-70 w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("input",{type:"text",placeholder:"Username",required:!0,value:x,onChange:s=>{_(s.target.value),t(null)},className:`w-full pl-10 sm:pl-10 pr-4 py-2.5 sm:py-3 rounded-lg bg-[#2c1b4a] border border-[#8a4fff]/20 text-white text-[14px] sm:text-base
                          focus:outline-none focus:border-[#8a4fff] transition-all duration-300`})]}),e.jsxs("div",{className:"relative",children:[e.jsx(I,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-[#8a4fff] opacity-70 w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("input",{type:f?"text":"password",placeholder:"Password",required:!0,value:w,onChange:s=>{L(s.target.value),t(null)},className:`w-full pl-10 sm:pl-10 pr-10 py-2.5 sm:py-3 rounded-lg bg-[#2c1b4a] border border-[#8a4fff]/20 text-white text-[14px] sm:text-base
                        focus:outline-none focus:border-[#8a4fff] transition-all duration-300`}),e.jsx(l.button,{type:"button",onClick:()=>E(!f),whileHover:{scale:1.2},whileTap:{scale:1.2},className:"absolute right-3 lg:bottom-4 bottom-3 text-[#8a4fff] opacity-70",children:f?e.jsx(C,{className:"w-4 h-4 sm:w-5 sm:h-5"}):e.jsx(U,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]}),n==="signup"&&e.jsxs("div",{className:"relative",children:[e.jsx(I,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-[#8a4fff] opacity-70 w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("input",{type:f?"text":"password",placeholder:"Confirm Password",required:!0,value:k,onChange:s=>{R(s.target.value),t(null)},className:`w-full pl-10 sm:pl-10 pr-10 py-2.5 sm:py-3 rounded-lg bg-[#2c1b4a] border border-[#8a4fff]/20 text-white text-[14px] sm:text-base
                          focus:outline-none focus:border-[#8a4fff] transition-all duration-300`}),e.jsx(l.button,{type:"button",onClick:()=>E(!f),whileHover:{scale:1.2},whileTap:{scale:1.2},className:"absolute right-3 lg:bottom-4 bottom-3 text-[#8a4fff] opacity-70",children:f?e.jsx(C,{className:"w-4 h-4 sm:w-5 sm:h-5"}):e.jsx(U,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]}),n==="forgot-password"&&e.jsxs("div",{className:"relative",children:[e.jsx(T,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-[#8a4fff] opacity-70 w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("input",{type:"email",placeholder:"Enter your email",required:!0,value:c,onChange:s=>{S(s.target.value),t(null)},className:`w-full pl-10 sm:pl-10 pr-4 py-2.5 sm:py-3 rounded-lg bg-[#2c1b4a] border border-[#8a4fff]/20 text-white text-[14px] sm:text-base
                      focus:outline-none focus:border-[#8a4fff] transition-all duration-300`})]}),e.jsxs(l.button,{...z,type:"submit",disabled:v,className:`
                  w-full bg-gradient-to-r from-[#8a4fff] to-[#5e3c9b] 
                  text-white py-2.5 sm:py-3 rounded-lg text-[14px] sm:text-base
                  flex items-center justify-center
                  hover:opacity-90 transition-opacity
                  ${v?"opacity-50 cursor-not-allowed":""}
                `,children:[v?"Processing...":n==="signin"?"Sign In":n==="signup"?"Create Account":"Send Reset Link",!v&&e.jsx(G,{className:"ml-2 w-4 h-4 sm:w-5 sm:h-5"})]}),n==="signin"&&e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"button",onClick:()=>d("forgot-password"),className:"text-[#8a4fff] hover:underline text-[14px] sm:text-base",children:"Forgot Password?"})})]}),e.jsxs(l.div,{initial:{opacity:1},animate:{opacity:1},transition:{delay:.4},className:"bg-[#2c1b4a] border-t border-[#8a4fff]/10 p-4 sm:p-4 text-center",children:[n==="signin"&&e.jsxs("p",{className:"text-gray-400 text-[14px] sm:text-base",children:["Don't have an account?"," ",e.jsx(l.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>d("signup"),className:"text-[#8a4fff] hover:underline",children:"Sign Up"})]}),n==="signup"&&e.jsxs("p",{className:"text-gray-400 text-[14px] sm:text-base",children:["Already have an account?"," ",e.jsx(l.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>d("signin"),className:"text-[#8a4fff] hover:underline",children:"Sign In"})]}),n==="forgot-password"&&e.jsxs("p",{className:"text-gray-400 text-[13px] sm:text-base",children:["Remember your password?"," ",e.jsx(l.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>d("signin"),className:"text-[#8a4fff] hover:underline",children:"Sign In"})]})]})]})]})})]})};export{ee as default};
